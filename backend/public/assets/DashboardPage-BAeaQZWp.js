import{j as e,u as A,a as I,d as T,r as U,L as O,c as y}from"./index-BrG7qY3B.js";import{r as x,L as w}from"./vendor-react-DsCSLZ3L.js";import{S as Y,a as E}from"./SalesPieChart-DsLdb6Rk.js";import{R as F,L as M,a as B}from"./vendor-charts-DGg1Za7c.js";import{T as k,R as _,g as $,S as q,h as S,i as K,U as V,P as L,j as W,A as G,k as H}from"./vendor-icons-DU-kWQ55.js";import"./vendor-utils-DMdnf9MG.js";function J({data:n,height:a=40,width:c=100,color:m="var(--color-primary-500)",strokeWidth:r=2}){if(!n||n.length===0)return null;const s=n.map((d,o)=>({index:o,value:d})),l=(n.length>=2?n[n.length-1]-n[0]:0)>=0?"var(--color-success-500)":"var(--color-error-500)";return e.jsx(F,{width:c,height:a,children:e.jsx(M,{data:s,children:e.jsx(B,{type:"monotone",dataKey:"value",stroke:m==="auto"?l:m,strokeWidth:r,dot:!1})})})}function se(){const{user:n}=A(),{t:a,locale:c}=I(),[m,r]=x.useState(!0),[s,b]=x.useState(null),[l,d]=x.useState(null),[o,h]=x.useState(null),[C]=x.useState(new Date),j=t=>new Intl.NumberFormat(c==="ar"?"ar-LY":"en-LY",{style:"currency",currency:"LYD",minimumFractionDigits:3}).format(t),u=t=>new Intl.NumberFormat(c==="ar"?"ar-LY":"en-LY").format(t),g=x.useCallback(async()=>{r(!0),h(null);try{const t=await T.metrics();b(t);try{const i=await U.sales({date_from:new Date(Date.now()-6048e5).toISOString().split("T")[0],date_to:new Date().toISOString().split("T")[0]});d(i)}catch(i){console.warn("Sales report unavailable:",i),d(null)}}catch(t){console.error("Failed to load dashboard:",t),t.response?.status===401?h(a("error.session_expired","Session expired. Please login again.")):h(a("error.load_failed","Failed to load data"))}finally{r(!1)}},[a]);if(x.useEffect(()=>{g();const t=setInterval(g,300*1e3);return()=>clearInterval(t)},[g]),m)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-[60vh]",children:[e.jsx(O,{size:"lg"}),e.jsx("p",{className:"mt-4 text-gray-500 animate-pulse",children:a("common.loading","Loading dashboard...")})]});if(o)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-[60vh] text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 text-red-600 rounded-full flex items-center justify-center mb-4",children:e.jsx(k,{className:"w-8 h-8"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:a("error.error_occurred","Something went wrong")}),e.jsx("p",{className:"text-gray-500 mb-6 max-w-md",children:o}),e.jsxs("button",{onClick:g,className:"btn btn-primary flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4"}),a("common.retry","Retry")]})]});const z=l?.by_date||[],D=(l?.by_category||l?.sales_by_category||[]).map(t=>({name:t.name||t.category_name||"Unknown",value:t.revenue||t.total||0})),f=(l?.by_payment_method||[]).map(t=>({name:t.method,value:t.amount}));return e.jsxs("div",{className:"space-y-8 pb-10 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white tracking-tight",children:[a("dashboard.welcome","Welcome back"),", ",n?.name?.split(" ")[0],"! ðŸ‘‹"]}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mt-1 flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),C.toLocaleDateString(c==="ar"?"ar-LY":"en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(w,{to:"/pos",className:"btn btn-primary shadow-lg shadow-blue-500/20 flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4"}),a("nav.pos","Open POS")]}),e.jsx("button",{onClick:g,className:"p-2.5 rounded-xl bg-white dark:bg-zinc-800 border border-gray-200 dark:border-zinc-700 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-zinc-700 transition-colors",title:a("common.refresh","Refresh"),children:e.jsx(_,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5",children:[e.jsx(p,{title:a("dashboard.today_sales","Today's Sales"),value:j(s?.today?.revenue||0),icon:e.jsx(S,{className:"w-6 h-6 text-white"}),iconBg:"bg-gradient-to-br from-blue-500 to-blue-600",trend:s?.trends?.revenue_7_days,trendLabel:a("dashboard.vs_last_week","vs last week")}),e.jsx(p,{title:a("dashboard.today_orders","Today's Orders"),value:u(s?.today?.sales_count||s?.today_orders||0),icon:e.jsx(K,{className:"w-6 h-6 text-white"}),iconBg:"bg-gradient-to-br from-purple-500 to-purple-600",trend:s?.trends?.sales_7_days}),e.jsx(p,{title:a("dashboard.new_customers","New Customers"),value:u(s?.today?.new_customers||0),icon:e.jsx(V,{className:"w-6 h-6 text-white"}),iconBg:"bg-gradient-to-br from-emerald-500 to-emerald-600",subValue:`${a("dashboard.active_users","Active Users")}: ${s?.active_users||0}`}),e.jsx(p,{title:a("dashboard.low_stock","Low Stock Items"),value:u(s?.low_stock_alert||s?.low_stock_count||0),icon:e.jsx(k,{className:"w-6 h-6 text-white"}),iconBg:"bg-gradient-to-br from-amber-500 to-amber-600",variant:(s?.low_stock_alert||0)>0?"warning":"default",link:"/inventory"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white dark:bg-zinc-900 rounded-2xl border border-gray-100 dark:border-zinc-800 shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:a("dashboard.sales_trend","Sales Overview")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Last 7 days performance"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"flex items-center gap-1 text-xs font-medium px-2.5 py-1 rounded-full bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",children:[e.jsx(S,{className:"w-3 h-3"}),"+12.5%"]})})]}),e.jsx("div",{className:"h-[300px] w-full",children:e.jsx(Y,{data:z,height:300})})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-2xl border border-gray-100 dark:border-zinc-800 shadow-sm p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-1",children:a("dashboard.sales_by_category","Category Share")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-6",children:"Revenue distribution"}),e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsx(E,{data:D,height:280})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white dark:bg-zinc-900 rounded-2xl border border-gray-100 dark:border-zinc-800 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100 dark:border-zinc-800 flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-gray-400"}),a("dashboard.top_products","Top Selling Products")]}),e.jsx(w,{to:"/reports",className:"text-sm font-medium text-blue-600 hover:text-blue-700 dark:text-blue-400",children:a("common.view_all","View All")})]}),l?.top_products&&l.top_products.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-zinc-800/50 text-gray-500 dark:text-gray-400 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-start",children:"#"}),e.jsx("th",{className:"px-6 py-3 text-start",children:a("products.name","Product")}),e.jsx("th",{className:"px-6 py-3 text-end",children:a("reports.quantity_sold","Sold")}),e.jsx("th",{className:"px-6 py-3 text-end",children:a("reports.revenue","Revenue")})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 dark:divide-zinc-800",children:l.top_products.slice(0,5).map((t,i)=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-zinc-800/50 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4 text-gray-400 w-12",children:["0",i+1]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:t.product_name})}),e.jsx("td",{className:"px-6 py-4 text-end text-gray-600 dark:text-gray-400",children:u(t.quantity_sold)}),e.jsx("td",{className:"px-6 py-4 text-end font-semibold text-gray-900 dark:text-white",children:j(t.revenue)})]},t.product_id))})]})}):e.jsxs("div",{className:"p-12 text-center text-gray-400",children:[e.jsx(L,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:a("reports.no_data","No sales data available yet")})]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-2xl border border-gray-100 dark:border-zinc-800 shadow-sm p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-2",children:[e.jsx(W,{className:"w-5 h-5 text-gray-400"}),a("dashboard.payment_methods","Payment Methods")]}),f.length>0?e.jsx("div",{className:"space-y-4",children:f.map((t,i)=>{const N=f.reduce((R,P)=>R+P.value,0),v=N>0?Math.round(t.value/N*100):0;return e.jsxs("div",{className:"group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:t.name}),e.jsx("span",{className:"text-sm font-bold text-gray-900 dark:text-white",children:j(t.value)})]}),e.jsx("div",{className:"w-full h-2 bg-gray-100 dark:bg-zinc-800 rounded-full overflow-hidden",children:e.jsx("div",{className:y("h-full rounded-full transition-all duration-500",i===0?"bg-blue-500":i===1?"bg-purple-500":"bg-emerald-500"),style:{width:`${v}%`}})}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1 text-end",children:[v,"%"]})]},t.name)})}):e.jsx("div",{className:"p-8 text-center text-gray-400",children:e.jsx("p",{children:a("reports.no_data","No payment data")})})]})]})]})}function p({title:n,value:a,icon:c,iconBg:m,trend:r,subValue:s,variant:b="default",link:l}){const d=r&&r.length>=2?Math.round((r[r.length-1]-r[0])/(r[0]||1)*100):null,o=d!==null&&d>=0,h=e.jsxs("div",{className:y("bg-white dark:bg-zinc-900 rounded-2xl p-5 border shadow-sm transition-all hover:shadow-md",b==="warning"?"border-amber-200 bg-amber-50 dark:bg-amber-900/10 dark:border-amber-800":"border-gray-100 dark:border-zinc-800"),children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:y("p-3 rounded-xl shadow-sm",m),children:c}),d!==null&&e.jsxs("div",{className:y("flex items-center gap-1 text-xs font-bold px-2 py-1 rounded-full",o?"text-green-700 bg-green-100 dark:bg-green-900/30 dark:text-green-400":"text-red-700 bg-red-100 dark:bg-red-900/30 dark:text-red-400"),children:[o?e.jsx(G,{className:"w-3 h-3"}):e.jsx(H,{className:"w-3 h-3"}),Math.abs(d),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-1",children:n}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white tracking-tight",children:a}),s&&e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:s}),r&&e.jsx("div",{className:"mt-3 h-8 opacity-50",children:e.jsx(J,{data:r,color:o?"#10b981":"#ef4444",width:120,height:32})})]})]});return l?e.jsx(w,{to:l,className:"block",children:h}):h}export{se as DashboardPage,se as default};
