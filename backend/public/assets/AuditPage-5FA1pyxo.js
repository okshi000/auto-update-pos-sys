import{a as A,I as D,t as I,j as e,B as x,S as O}from"./index-JnHVxLbD.js";import{r}from"./vendor-react-DsCSLZ3L.js";import{M as E}from"./Modal-D5rG5aoT.js";import{D as U}from"./DataTable-DJ4uobWj.js";import{D as M}from"./DateRangePicker-Cadj_YRI.js";import"./vendor-utils-DMdnf9MG.js";import"./vendor-charts-DGg1Za7c.js";import"./vendor-icons-DU-kWQ55.js";const y={create:"success",update:"warning",delete:"danger",login:"info",logout:"default",view:"default"};function J(){const{t:a,locale:m}=A(),[h,j]=r.useState([]),[f,p]=r.useState(!0),[l,u]=r.useState({currentPage:1,totalPages:1,totalItems:0,perPage:25}),[n,N]=r.useState(""),[i,_]=r.useState({start:null,end:null}),[c,b]=r.useState(""),[d,w]=r.useState(""),[s,g]=r.useState(null),v=r.useCallback(async()=>{p(!0);try{const t={page:l.currentPage,per_page:l.perPage,search:n||void 0,action:c||void 0,entity_type:d||void 0,date_from:i.start?.toISOString().split("T")[0]||void 0,date_to:i.end?.toISOString().split("T")[0]||void 0},o=await D.list(t);j(o.data),u(L=>({...L,currentPage:o.meta.current_page,totalPages:o.meta.last_page,totalItems:o.meta.total}))}catch{I.error(a("error.load_failed","Failed to load audit logs"))}finally{p(!1)}},[l.currentPage,l.perPage,n,i,c,d,a]);r.useEffect(()=>{v()},[v]),r.useEffect(()=>{u(t=>({...t,currentPage:1}))},[n,i,c,d]);const S=[{key:"created_at",header:a("audit.timestamp","Timestamp"),width:"180px",render:t=>e.jsx("span",{className:"text-sm",style:{color:"var(--color-gray-600)"},children:new Date(t.created_at).toLocaleString(m)})},{key:"user",header:a("audit.user","User"),render:t=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-semibold",style:{backgroundColor:"var(--color-primary-100)",color:"var(--color-primary-700)"},children:t.user?.name?.charAt(0).toUpperCase()||"?"}),e.jsx("span",{style:{color:"var(--color-gray-900)"},children:t.user?.name||a("audit.system","System")})]})},{key:"action",header:a("audit.action","Action"),width:"100px",render:t=>e.jsx(x,{variant:y[t.action]||"default",children:t.action.toUpperCase()})},{key:"entity_type",header:a("audit.entity","Entity"),hideOnMobile:!0,render:t=>e.jsxs("span",{style:{color:"var(--color-gray-700)"},children:[t.entity_type,t.entity_id&&e.jsxs("span",{className:"text-sm ms-1",style:{color:"var(--color-gray-500)"},children:["#",t.entity_id]})]})},{key:"description",header:a("audit.description","Description"),hideOnMobile:!0,render:t=>e.jsx("span",{className:"text-sm truncate max-w-xs",style:{color:"var(--color-gray-600)"},children:t.description||"-"})},{key:"ip_address",header:a("audit.ip","IP"),hideOnMobile:!0,width:"120px",render:t=>e.jsx("span",{className:"font-mono text-sm",style:{color:"var(--color-gray-500)"},children:t.ip_address||"-"})}],k=t=>e.jsx("button",{onClick:()=>g(t),className:"btn btn-ghost p-2",title:a("common.view","View Details"),children:e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),C=[{value:"",label:a("common.all_actions","All Actions")},{value:"create",label:a("audit.create","Create")},{value:"update",label:a("audit.update","Update")},{value:"delete",label:a("audit.delete","Delete")},{value:"login",label:a("audit.login","Login")},{value:"logout",label:a("audit.logout","Logout")}],P=[{value:"",label:a("common.all_entities","All Entities")},{value:"Product",label:a("audit.product","Product")},{value:"Sale",label:a("audit.sale","Sale")},{value:"User",label:a("audit.user","User")},{value:"Role",label:a("audit.role","Role")},{value:"Inventory",label:a("audit.inventory","Inventory")},{value:"Category",label:a("audit.category","Category")},{value:"Setting",label:a("audit.setting","Setting")}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl font-semibold",style:{color:"var(--color-gray-900)"},children:a("nav.audit","Audit Log")}),e.jsxs("div",{className:"text-sm",style:{color:"var(--color-gray-500)"},children:[l.totalItems," ",a("common.records","records")]})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(O,{value:n,onChange:N,placeholder:a("audit.search_placeholder","Search by user, description...")})}),e.jsx("div",{className:"w-full lg:w-80",children:e.jsx(M,{value:i,onChange:_})}),e.jsx("select",{value:c,onChange:t=>b(t.target.value),className:"input",style:{width:"auto",minWidth:"130px"},children:C.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx("select",{value:d,onChange:t=>w(t.target.value),className:"input",style:{width:"auto",minWidth:"130px"},children:P.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})}),e.jsx("div",{className:"card p-0",children:e.jsx(U,{columns:S,data:h,keyExtractor:t=>t.id,isLoading:f,emptyIcon:"ðŸ“‹",emptyTitle:a("audit.empty","No audit logs found"),emptyDescription:a("audit.empty_desc","System activities will appear here"),rowActions:k,pagination:{...l,onPageChange:t=>u(o=>({...o,currentPage:t}))}})}),e.jsx(E,{isOpen:s!==null,onClose:()=>g(null),title:a("audit.details","Audit Log Details"),size:"md",children:s&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("span",{style:{color:"var(--color-gray-500)"},children:[a("audit.timestamp","Timestamp"),":"]}),e.jsx("div",{className:"font-medium",style:{color:"var(--color-gray-900)"},children:new Date(s.created_at).toLocaleString(m)})]}),e.jsxs("div",{children:[e.jsxs("span",{style:{color:"var(--color-gray-500)"},children:[a("audit.user","User"),":"]}),e.jsx("div",{className:"font-medium",style:{color:"var(--color-gray-900)"},children:s.user?.name||a("audit.system","System")})]}),e.jsxs("div",{children:[e.jsxs("span",{style:{color:"var(--color-gray-500)"},children:[a("audit.action","Action"),":"]}),e.jsx("div",{children:e.jsx(x,{variant:y[s.action]||"default",children:s.action.toUpperCase()})})]}),e.jsxs("div",{children:[e.jsxs("span",{style:{color:"var(--color-gray-500)"},children:[a("audit.entity","Entity"),":"]}),e.jsxs("div",{className:"font-medium",style:{color:"var(--color-gray-900)"},children:[s.entity_type," #",s.entity_id]})]}),e.jsxs("div",{children:[e.jsxs("span",{style:{color:"var(--color-gray-500)"},children:[a("audit.ip","IP Address"),":"]}),e.jsx("div",{className:"font-mono",style:{color:"var(--color-gray-900)"},children:s.ip_address||"-"})]}),e.jsxs("div",{children:[e.jsxs("span",{style:{color:"var(--color-gray-500)"},children:[a("audit.user_agent","User Agent"),":"]}),e.jsx("div",{className:"text-xs truncate",style:{color:"var(--color-gray-600)"},children:s.user_agent||"-"})]})]}),s.description&&e.jsxs("div",{children:[e.jsxs("span",{className:"text-sm",style:{color:"var(--color-gray-500)"},children:[a("audit.description","Description"),":"]}),e.jsx("p",{className:"mt-1 p-3 rounded-lg text-sm",style:{backgroundColor:"var(--color-gray-50)",color:"var(--color-gray-700)"},children:s.description})]}),(s.old_values||s.new_values)&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.old_values&&e.jsxs("div",{children:[e.jsxs("span",{className:"text-sm",style:{color:"var(--color-gray-500)"},children:[a("audit.old_values","Previous Values"),":"]}),e.jsx("pre",{className:"mt-1 p-3 rounded-lg text-xs overflow-auto",style:{backgroundColor:"var(--color-error-50)",color:"var(--color-gray-700)",maxHeight:"200px"},children:JSON.stringify(s.old_values,null,2)})]}),s.new_values&&e.jsxs("div",{children:[e.jsxs("span",{className:"text-sm",style:{color:"var(--color-gray-500)"},children:[a("audit.new_values","New Values"),":"]}),e.jsx("pre",{className:"mt-1 p-3 rounded-lg text-xs overflow-auto",style:{backgroundColor:"var(--color-success-50)",color:"var(--color-gray-700)",maxHeight:"200px"},children:JSON.stringify(s.new_values,null,2)})]})]})]})})]})}export{J as AuditPage,J as default};
