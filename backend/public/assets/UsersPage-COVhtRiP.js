import{a as I,f as V,q as x,t as f,v as G,j as e,B as R,S as J}from"./index-BnL1Xpg8.js";import{r as i}from"./vendor-react-DsCSLZ3L.js";import{M as K}from"./Modal-D_3ZWCmE.js";import{C as Q}from"./ConfirmDialog-DK5HF7hc.js";import{D as X}from"./DataTable-L1WogRDr.js";import{F as g}from"./FormField-Yls4ILqE.js";import{F as Y}from"./FormError-DDW1e3jQ.js";import{F as ee}from"./FormActions-yCzbOGcx.js";import"./vendor-utils-DMdnf9MG.js";import"./vendor-charts-DGg1Za7c.js";import"./vendor-icons-DU-kWQ55.js";function pe(){const{t,locale:w}=I(),{hasPermission:l}=V(),S=l("users.create"),k=l("users.edit"),o=l("users.delete"),[m,r]=i.useState([]),[c,d]=i.useState([]),[N,y]=i.useState(!0),[p,j]=i.useState({currentPage:1,totalPages:1,totalItems:0,perPage:15}),[h,L]=i.useState(""),[v,U]=i.useState(null),[a,n]=i.useState(""),[A,C]=i.useState(!1),[T,F]=i.useState(null),[D,E]=i.useState(null),[B,P]=i.useState(!1),_=i.useCallback(async()=>{y(!0);try{const s=await x.list({page:p.currentPage,per_page:p.perPage,search:h||void 0,is_active:a==="active"?!0:a==="inactive"?!1:void 0});let u=s.data;v&&(u=s.data.filter(b=>b.roles?.some(q=>typeof q=="string"?!1:q.id===v))),r(u),j(b=>({...b,currentPage:s.meta.current_page,totalPages:s.meta.last_page,totalItems:s.meta.total}))}catch{f.error(t("error.load_failed","Failed to load users"))}finally{y(!1)}},[p.currentPage,p.perPage,h,v,a,t]),M=i.useCallback(async()=>{try{const s=await G.list();d(s.data)}catch{}},[]),W=async()=>{if(D){P(!0);try{await x.delete(D.id),f.success(t("users.deleted","User deleted successfully")),E(null),_()}catch{f.error(t("error.delete_failed","Failed to delete user"))}finally{P(!1)}}},z=async s=>{try{await x.toggleActive(s.id),f.success(s.is_active?t("users.deactivated","User deactivated"):t("users.activated","User activated")),_()}catch{f.error(t("error.update_failed","Failed to update user"))}};i.useEffect(()=>{_()},[_]),i.useEffect(()=>{M()},[M]),i.useEffect(()=>{j(s=>({...s,currentPage:1}))},[h,v,a]);const O=[{key:"name",header:t("users.name","Name"),sortable:!0,render:s=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center font-semibold",style:{backgroundColor:"var(--color-primary-100)",color:"var(--color-primary-700)"},children:s.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:"var(--color-gray-900)"},children:s.name}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-gray-500)"},children:s.email})]})]})},{key:"roles",header:t("users.roles","Roles"),hideOnMobile:!0,render:s=>e.jsx("div",{className:"flex flex-wrap gap-1",children:s.roles?.map((u,b)=>e.jsx(R,{variant:"info",size:"sm",children:typeof u=="string"?u:u.name},typeof u=="string"?b:u.id))||"-"})},{key:"is_active",header:t("users.status","Status"),align:"center",width:"100px",render:s=>e.jsx(R,{variant:s.is_active?"success":"danger",dot:!0,children:s.is_active?t("users.active","Active"):t("users.inactive","Inactive")})},{key:"last_login",header:t("users.last_login","Last Login"),hideOnMobile:!0,render:s=>e.jsx("span",{style:{color:"var(--color-gray-600)"},children:s.last_login_at?new Date(s.last_login_at).toLocaleDateString(w):t("users.never","Never")})},{key:"created_at",header:t("users.created","Created"),hideOnMobile:!0,render:s=>e.jsx("span",{style:{color:"var(--color-gray-600)"},children:new Date(s.created_at).toLocaleDateString(w)})}],$=s=>e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[k&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{F(s),C(!0)},className:"btn btn-ghost p-2",title:t("common.edit","Edit"),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>z(s),className:"btn btn-ghost p-2",title:s.is_active?t("users.deactivate","Deactivate"):t("users.activate","Activate"),children:s.is_active?e.jsx("svg",{className:"w-4 h-4",style:{color:"var(--color-warning-600)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"})}):e.jsx("svg",{className:"w-4 h-4",style:{color:"var(--color-success-600)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),o&&e.jsx("button",{onClick:()=>E(s),className:"btn btn-ghost p-2",style:{color:"var(--color-error-600)"},title:t("common.delete","Delete"),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),H=[{value:"",label:t("common.all_roles","All Roles")},...c.map(s=>({value:s.id,label:s.name}))],Z=[{value:"",label:t("common.all_statuses","All Statuses")},{value:"active",label:t("users.active","Active")},{value:"inactive",label:t("users.inactive","Inactive")}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl font-semibold",style:{color:"var(--color-gray-900)"},children:t("nav.users","Users")}),S&&e.jsxs("button",{onClick:()=>{F(null),C(!0)},className:"btn btn-primary",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),t("users.add","Add User")]})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(J,{value:h,onChange:L,placeholder:t("users.search_placeholder","Search by name or email...")})}),e.jsx("select",{value:v||"",onChange:s=>U(s.target.value?parseInt(s.target.value):null),className:"input",style:{width:"auto",minWidth:"150px"},children:H.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsx("select",{value:a,onChange:s=>n(s.target.value),className:"input",style:{width:"auto",minWidth:"150px"},children:Z.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})}),e.jsx("div",{className:"card p-0",children:e.jsx(X,{columns:O,data:m,keyExtractor:s=>s.id,isLoading:N,emptyIcon:"ðŸ‘¥",emptyTitle:t("users.empty","No users found"),emptyDescription:t("users.empty_desc","Create a new user to get started"),rowActions:k||o?$:void 0,pagination:{...p,onPageChange:s=>j(u=>({...u,currentPage:s}))}})}),e.jsx(se,{isOpen:A,onClose:()=>C(!1),user:T,roles:c,onSuccess:()=>{C(!1),_()}}),e.jsx(Q,{isOpen:D!==null,onClose:()=>E(null),onConfirm:W,title:t("users.delete_user","Delete User"),message:t("users.delete_confirm","Are you sure you want to delete this user? This action cannot be undone."),confirmLabel:t("common.delete","Delete"),variant:"danger",isLoading:B})]})}function se({isOpen:t,onClose:w,user:l,roles:S,onSuccess:k}){const{t:o}=I(),m=l!==null,[r,c]=i.useState({name:"",email:"",password:"",password_confirmation:"",is_active:!0,role_ids:[]}),[d,N]=i.useState({}),[y,p]=i.useState(null),[j,h]=i.useState(!1);i.useEffect(()=>{t&&(c(l?{name:l.name,email:l.email,password:"",password_confirmation:"",is_active:l.is_active,role_ids:l.roles?.map(a=>typeof a=="string"?0:a.id).filter(a=>a>0)||[]}:{name:"",email:"",password:"",password_confirmation:"",is_active:!0,role_ids:[]}),N({}),p(null))},[t,l]);const L=()=>{const a={};return r.name.trim()||(a.name=o("validation.required","This field is required")),r.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.email)||(a.email=o("validation.email","Invalid email format")):a.email=o("validation.required","This field is required"),!m&&!r.password&&(a.password=o("validation.required","This field is required")),r.password&&(r.password.length<8?a.password=o("validation.password_min","Must be at least 8 characters"):/(?=.*[a-z])(?=.*[A-Z])/.test(r.password)?/(?=.*\d)/.test(r.password)||(a.password=o("validation.password_numbers","Must contain at least one number")):a.password=o("validation.password_mixed_case","Must contain uppercase and lowercase letters")),r.password&&r.password!==r.password_confirmation&&(a.password_confirmation=o("validation.password_match","Passwords do not match")),N(a),Object.keys(a).length===0},v=async a=>{if(a.preventDefault(),!!L()){h(!0),p(null);try{if(m&&l){const n={name:r.name,email:r.email};r.password&&(n.password=r.password,n.password_confirmation=r.password_confirmation),await x.update(l.id,n),await x.assignRoles(l.id,r.role_ids),f.success(o("users.updated","User updated successfully"))}else await x.create({name:r.name,email:r.email,password:r.password,roles:r.role_ids}),f.success(o("users.created","User created successfully"));k()}catch(n){p(n instanceof Error?n.message:o("error.save_failed","Failed to save"))}finally{h(!1)}}},U=a=>{c(n=>({...n,role_ids:n.role_ids.includes(a)?n.role_ids.filter(A=>A!==a):[...n.role_ids,a]}))};return e.jsx(K,{isOpen:t,onClose:w,title:m?o("users.edit_user","Edit User"):o("users.add_user","Add User"),size:"md",children:e.jsxs("form",{onSubmit:v,children:[y&&e.jsx(Y,{message:y}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(g,{label:o("users.name","Name"),required:!0,error:d.name,children:e.jsx("input",{type:"text",value:r.name,onChange:a=>c({...r,name:a.target.value}),className:`input ${d.name?"input-error":""}`,placeholder:o("users.name_placeholder","Enter full name")})}),e.jsx(g,{label:o("users.email","Email"),required:!0,error:d.email,children:e.jsx("input",{type:"email",value:r.email,onChange:a=>c({...r,email:a.target.value}),className:`input ${d.email?"input-error":""}`,placeholder:o("users.email_placeholder","name@company.com")})}),e.jsx(g,{label:o("users.password","Password"),required:!m,hint:m?o("users.password_hint","Leave blank to keep current password"):void 0,error:d.password,children:e.jsx("input",{type:"password",value:r.password,onChange:a=>c({...r,password:a.target.value}),className:`input ${d.password?"input-error":""}`,placeholder:m?"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢":o("users.password_placeholder","Min 8 chars, A-Z, a-z, 0-9")})}),r.password&&e.jsx(g,{label:o("users.confirm_password","Confirm Password"),required:!0,error:d.password_confirmation,children:e.jsx("input",{type:"password",value:r.password_confirmation,onChange:a=>c({...r,password_confirmation:a.target.value}),className:`input ${d.password_confirmation?"input-error":""}`,placeholder:o("users.confirm_placeholder","Repeat password")})}),e.jsx(g,{label:o("users.roles","Roles"),children:e.jsx("div",{className:"flex flex-wrap gap-2",children:S.map(a=>e.jsx("button",{type:"button",onClick:()=>U(a.id),className:"px-3 py-2 rounded-lg border transition-colors",style:{borderColor:r.role_ids.includes(a.id)?"var(--color-primary-600)":"var(--color-gray-300)",backgroundColor:r.role_ids.includes(a.id)?"var(--color-primary-50)":"var(--color-white)",color:r.role_ids.includes(a.id)?"var(--color-primary-700)":"var(--color-gray-700)"},children:a.name},a.id))})}),e.jsx(g,{label:o("users.status","Status"),children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.is_active,onChange:a=>c({...r,is_active:a.target.checked}),className:"w-5 h-5 rounded",style:{accentColor:"var(--color-primary-600)"}}),e.jsx("span",{style:{color:"var(--color-gray-700)"},children:o("users.user_active","User is active")})]})})]}),e.jsx(ee,{onCancel:w,isSubmitting:j,submitLabel:m?o("common.save","Save"):o("users.create","Create User")})]})})}export{pe as UsersPage,pe as default};
