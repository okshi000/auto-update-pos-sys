import{a as A,j as e,f as L,t as C,L as le,g as de,h as I,B as ue,S as me}from"./index-BrG7qY3B.js";import{r as a}from"./vendor-react-DsCSLZ3L.js";import{C as R}from"./ConfirmDialog-BQzFRRg7.js";import{E as pe,D as ge}from"./DataTable-CtexW7zD.js";import{S as H}from"./Select-iVBs9-gR.js";import{M as K}from"./Modal-BHzPZ2lZ.js";import{C as $}from"./CurrencyInput-DcbfaEzB.js";import{F as b}from"./FormField-DPEJlArV.js";import{F as Y}from"./FormError-HUbSNJdP.js";import{F as G}from"./FormActions-CgwOfQrw.js";import"./vendor-utils-DMdnf9MG.js";import"./vendor-charts-DGg1Za7c.js";import"./vendor-icons-DU-kWQ55.js";function V(t){return t?{sku:t.sku||"",barcode:t.barcode||"",name:t.name,description:t.description||"",category_id:t.category_id,cost_price:t.cost_price,price:t.price,min_stock_level:t.min_stock_level,is_active:t.is_active}:{sku:"",barcode:"",name:"",description:"",category_id:null,cost_price:0,price:0,min_stock_level:0,is_active:!0}}function he({isOpen:t,onClose:f,onSubmit:m,product:n,categories:d,isLoading:y=!1}){const{t:r}=A(),g=!!n,k=a.useMemo(()=>V(n),[n]),h=a.useMemo(()=>`${n?.id??"new"}-${t}`,[n?.id,t]),[i,l]=a.useState(k),[u,v]=a.useState({}),[x,j]=a.useState(null),[c,S]=a.useState(h);h!==c&&(S(h),l(V(n)),v({}),j(null));const _=()=>{const o={};return i.name.trim()||(o.name=r("validation.required","This field is required")),i.price<=0&&(o.price=r("validation.positive","Must be greater than 0")),i.cost_price<0&&(o.cost_price=r("validation.non_negative","Cannot be negative")),v(o),Object.keys(o).length===0},p=async o=>{if(o.preventDefault(),j(null),!!_())try{await m(i),f()}catch(F){j(F instanceof Error?F.message:r("error.save_failed","Failed to save"))}},w=[{value:"",label:r("common.none","(None)")},...d.map(o=>({value:o.id,label:o.name}))];return e.jsx(K,{isOpen:t,onClose:f,title:g?r("products.edit","Edit Product"):r("products.create","Add Product"),size:"lg",children:e.jsxs("form",{onSubmit:p,children:[x&&e.jsx(Y,{message:x}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(b,{label:r("products.sku","SKU"),htmlFor:"sku",children:e.jsx("input",{id:"sku",type:"text",value:i.sku||"",onChange:o=>l({...i,sku:o.target.value||null}),className:"input",placeholder:"PRD-001"})}),e.jsx(b,{label:r("products.barcode","Barcode"),htmlFor:"barcode",children:e.jsx("input",{id:"barcode",type:"text",value:i.barcode||"",onChange:o=>l({...i,barcode:o.target.value||null}),className:"input",placeholder:"123456789012"})})]}),e.jsx(b,{label:r("products.name","Name"),htmlFor:"name",required:!0,error:u.name,children:e.jsx("input",{id:"name",type:"text",value:i.name,onChange:o=>l({...i,name:o.target.value}),className:`input ${u.name?"input-error":""}`})}),e.jsx(b,{label:r("products.description","Description"),htmlFor:"description",children:e.jsx("textarea",{id:"description",value:i.description||"",onChange:o=>l({...i,description:o.target.value||null}),className:"input",rows:3})}),e.jsx(b,{label:r("products.category","Category"),htmlFor:"category",children:e.jsx(H,{value:i.category_id??null,onChange:o=>l({...i,category_id:o}),options:w,clearable:!0,searchable:!0})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(b,{label:r("products.cost_price","Cost Price"),error:u.cost_price,children:e.jsx($,{value:i.cost_price,onChange:o=>l({...i,cost_price:o||0}),error:u.cost_price})}),e.jsx(b,{label:r("products.price","Price"),required:!0,error:u.price,children:e.jsx($,{value:i.price,onChange:o=>l({...i,price:o||0}),error:u.price})}),e.jsx(b,{label:r("products.min_stock","Min Stock Level"),children:e.jsx("input",{type:"number",min:"0",value:i.min_stock_level,onChange:o=>l({...i,min_stock_level:parseInt(o.target.value)||0}),className:"input"})})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("input",{id:"is_active",type:"checkbox",checked:i.is_active,onChange:o=>l({...i,is_active:o.target.checked}),className:"w-4 h-4 rounded",style:{accentColor:"var(--color-primary-600)"}}),e.jsx("label",{htmlFor:"is_active",style:{color:"var(--color-gray-700)"},children:r("products.is_active","Product is active")})]}),e.jsx(G,{onCancel:f,isSubmitting:y,submitLabel:g?r("common.update","Update"):r("common.create","Create")})]})})}function ve({isOpen:t,onClose:f,onCategoriesChange:m}){const{t:n}=A(),[d,y]=a.useState([]),[r,g]=a.useState(!1),[k,h]=a.useState(null),[i,l]=a.useState(!1),[u,v]=a.useState(null),[x,j]=a.useState(!1),c=a.useCallback(async()=>{g(!0);try{const p=await L.list();y(p)}catch{C.error(n("error.load_failed","Failed to load data"))}finally{g(!1)}},[n]);a.useEffect(()=>{t&&c()},[t,c]);const S=p=>{h(p),l(!0)},_=async()=>{if(u){j(!0);try{await L.delete(u),C.success(n("categories.deleted","Category deleted")),v(null),c(),m()}catch{C.error(n("error.delete_failed","Failed to delete"))}finally{j(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsxs(K,{isOpen:t,onClose:f,title:n("categories.manage","Manage Categories"),size:"lg",children:[e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:()=>{h(null),l(!0)},className:"btn btn-primary",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),n("categories.add","Add Category")]})}),r?e.jsx("div",{className:"py-8",children:e.jsx(le,{})}):d.length===0?e.jsx(pe,{icon:"ðŸ“",title:n("categories.empty","No categories yet"),description:n("categories.empty_desc","Create your first category to organize products")}):e.jsx("div",{className:"space-y-2",children:d.map(p=>e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border",style:{borderColor:"var(--color-gray-200)"},children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",style:{color:"var(--color-gray-900)"},children:p.name}),p.description&&e.jsx("p",{className:"text-sm",style:{color:"var(--color-gray-500)"},children:p.description}),p.products_count!==void 0&&e.jsxs("span",{className:"text-sm",style:{color:"var(--color-gray-400)"},children:[p.products_count," ",n("common.products","products")]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>S(p),className:"btn btn-ghost p-2",title:n("common.edit","Edit"),children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>v(p.id),className:"btn btn-ghost p-2",style:{color:"var(--color-error-600)"},title:n("common.delete","Delete"),disabled:(p.products_count??0)>0,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},p.id))})]}),e.jsx(xe,{isOpen:i,onClose:()=>{l(!1),h(null)},category:k,onSave:()=>{l(!1),h(null),c(),m()}}),e.jsx(R,{isOpen:u!==null,onClose:()=>v(null),onConfirm:_,title:n("categories.delete_title","Delete Category"),message:n("categories.delete_confirm","Are you sure you want to delete this category?"),confirmText:n("common.delete","Delete"),isLoading:x})]})}function xe({isOpen:t,onClose:f,category:m,onSave:n}){const{t:d}=A(),y=!!m,[r,g]=a.useState({name:"",description:"",is_active:!0}),[k,h]=a.useState({}),[i,l]=a.useState(null),[u,v]=a.useState(!1);a.useEffect(()=>{g(m?{name:m.name,description:m.description||"",is_active:m.is_active}:{name:"",description:"",is_active:!0}),h({}),l(null)},[m,t]);const x=()=>{const c={};return r.name.trim()||(c.name=d("validation.required","This field is required")),h(c),Object.keys(c).length===0},j=async c=>{if(c.preventDefault(),!!x()){v(!0),l(null);try{y&&m?(await L.update(m.id,r),C.success(d("categories.updated","Category updated"))):(await L.create(r),C.success(d("categories.created","Category created"))),n()}catch(S){l(S instanceof Error?S.message:d("error.save_failed","Failed to save"))}finally{v(!1)}}};return e.jsx(K,{isOpen:t,onClose:f,title:y?d("categories.edit","Edit Category"):d("categories.add","Add Category"),size:"md",children:e.jsxs("form",{onSubmit:j,children:[i&&e.jsx(Y,{message:i}),e.jsx(b,{label:d("categories.name","Name"),htmlFor:"cat-name",required:!0,error:k.name,children:e.jsx("input",{id:"cat-name",type:"text",value:r.name,onChange:c=>g({...r,name:c.target.value}),className:`input ${k.name?"input-error":""}`})}),e.jsx(b,{label:d("categories.description","Description"),htmlFor:"cat-description",children:e.jsx("textarea",{id:"cat-description",value:r.description||"",onChange:c=>g({...r,description:c.target.value||null}),className:"input",rows:3})}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("input",{id:"cat-is_active",type:"checkbox",checked:r.is_active,onChange:c=>g({...r,is_active:c.target.checked}),className:"w-4 h-4 rounded",style:{accentColor:"var(--color-primary-600)"}}),e.jsx("label",{htmlFor:"cat-is_active",style:{color:"var(--color-gray-700)"},children:d("categories.is_active","Category is active")})]}),e.jsx(G,{onCancel:f,isSubmitting:u,submitLabel:y?d("common.update","Update"):d("common.create","Create")})]})})}function Le(){const{t,locale:f}=A(),{hasPermission:m}=de(),n=m("products.create"),d=m("products.update"),y=m("products.delete"),[r,g]=a.useState([]),[k,h]=a.useState([]),[i,l]=a.useState(!0),[u,v]=a.useState({currentPage:1,totalPages:1,totalItems:0,perPage:15}),[x,j]=a.useState(""),[c,S]=a.useState(null),[_,p]=a.useState("all"),[w,o]=a.useState("name"),[F,z]=a.useState("asc"),[J,P]=a.useState(!1),[M,D]=a.useState(null),[O,q]=a.useState(null),[Q,T]=a.useState(!1),[X,W]=a.useState(!1),[Z,U]=a.useState(!1),E=a.useCallback(async()=>{l(!0);try{const s={page:u.currentPage,per_page:u.perPage,search:x||void 0,category_id:c,is_active:_==="all"?void 0:_==="active",sort_by:w,sort_direction:F},N=await I.list(s);g(N.data),v(ce=>({...ce,currentPage:N.meta.current_page,totalPages:N.meta.last_page,totalItems:N.meta.total}))}catch{C.error(t("error.load_failed","Failed to load products"))}finally{l(!1)}},[u.currentPage,u.perPage,x,c,_,w,F,t]),B=a.useCallback(async()=>{try{const s=await L.list();h(s)}catch{}},[]);a.useEffect(()=>{E()},[E]),a.useEffect(()=>{B()},[B]),a.useEffect(()=>{v(s=>({...s,currentPage:1}))},[x,c,_]);const ee=s=>{w===s?z(N=>N==="asc"?"desc":"asc"):(o(s),z("asc"))},te=async s=>{W(!0);try{M?(await I.update(M.id,s),C.success(t("products.updated","Product updated successfully"))):(await I.create(s),C.success(t("products.created","Product created successfully"))),P(!1),D(null),E()}finally{W(!1)}},se=async()=>{if(O){T(!0);try{await I.delete(O),C.success(t("products.deleted","Product deleted successfully")),q(null),E()}catch{C.error(t("error.delete_failed","Failed to delete product"))}finally{T(!1)}}},ae=s=>new Intl.NumberFormat(f,{minimumFractionDigits:3,maximumFractionDigits:3}).format(s)+" "+t("currency.lyd","LYD"),re=[{key:"sku",header:t("products.sku","SKU"),sortable:!0,width:"120px"},{key:"name",header:t("products.name","Name"),sortable:!0,render:s=>e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",style:{color:"var(--color-gray-900)"},children:s.name}),s.barcode&&e.jsx("div",{className:"text-xs",style:{color:"var(--color-gray-500)"},children:s.barcode})]})},{key:"category",header:t("products.category","Category"),hideOnMobile:!0,render:s=>e.jsx("span",{style:{color:"var(--color-gray-600)"},children:s.category?.name||"-"})},{key:"price",header:t("products.price","Price"),sortable:!0,align:"end",render:s=>e.jsx("span",{dir:"ltr",className:"font-medium",style:{color:"var(--color-gray-900)"},children:ae(s.price)})},{key:"stock_quantity",header:t("products.stock","Stock"),align:"end",hideOnMobile:!0,render:s=>e.jsx("span",{className:"font-medium",style:{color:(s.stock_quantity||0)<=s.min_stock_level?"var(--color-error-600)":"var(--color-gray-900)"},children:s.stock_quantity??"-"})},{key:"is_active",header:t("products.status","Status"),align:"center",width:"100px",render:s=>e.jsx(ue,{variant:s.is_active?"success":"default",dot:!0,children:s.is_active?t("common.active","Active"):t("common.inactive","Inactive")})}],oe=s=>e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[d&&e.jsx("button",{onClick:()=>{D(s),P(!0)},className:"btn btn-ghost p-2",title:t("common.edit","Edit"),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),y&&e.jsx("button",{onClick:()=>q(s.id),className:"btn btn-ghost p-2",style:{color:"var(--color-error-600)"},title:t("common.delete","Delete"),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),ie=[{value:"",label:t("common.all_categories","All Categories")},...k.map(s=>({value:s.id,label:s.name}))],ne=[{value:"all",label:t("common.all","All")},{value:"active",label:t("common.active","Active")},{value:"inactive",label:t("common.inactive","Inactive")}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl font-semibold",style:{color:"var(--color-gray-900)"},children:t("nav.products","Products")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>U(!0),className:"btn btn-secondary",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),t("categories.manage","Categories")]}),n&&e.jsxs("button",{onClick:()=>{D(null),P(!0)},className:"btn btn-primary",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),t("products.add","Add Product")]})]})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(me,{value:x,onChange:j,placeholder:t("products.search_placeholder","Search by name, SKU, or barcode...")})}),e.jsx("div",{className:"w-full lg:w-48",children:e.jsx(H,{value:c,onChange:s=>S(s),options:ie,clearable:!0})}),e.jsx("div",{className:"w-full lg:w-36",children:e.jsx(H,{value:_,onChange:s=>p(s||"all"),options:ne})})]})}),e.jsx("div",{className:"card p-0",children:e.jsx(ge,{columns:re,data:r,keyExtractor:s=>s.id,isLoading:i,emptyIcon:"ðŸ“¦",emptyTitle:t("products.empty","No products found"),emptyDescription:t("products.empty_desc","Add your first product to get started"),emptyAction:n?e.jsx("button",{onClick:()=>{D(null),P(!0)},className:"btn btn-primary",children:t("products.add","Add Product")}):void 0,sortKey:w,sortDirection:F,onSort:ee,rowActions:d||y?oe:void 0,pagination:{...u,onPageChange:s=>v(N=>({...N,currentPage:s}))}})}),e.jsx(he,{isOpen:J,onClose:()=>{P(!1),D(null)},onSubmit:te,product:M,categories:k,isLoading:X}),e.jsx(ve,{isOpen:Z,onClose:()=>U(!1),onCategoriesChange:B}),e.jsx(R,{isOpen:O!==null,onClose:()=>q(null),onConfirm:se,title:t("products.delete_title","Delete Product"),message:t("products.delete_confirm","Are you sure you want to delete this product? This action cannot be undone."),confirmText:t("common.delete","Delete"),isLoading:Q})]})}export{Le as ProductsPage,Le as default};
