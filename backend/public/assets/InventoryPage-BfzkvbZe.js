import{a as $,h as fe,i as q,j as e,L as O,B as D,t as k,w as K,g as ge,S as je}from"./index-Nde1j7Yg.js";import{r as a}from"./vendor-react-DsCSLZ3L.js";import{M as W}from"./Modal-CZ93Kggo.js";import{C as _e}from"./ConfirmDialog-BEamoI77.js";import{E as be,D as we}from"./DataTable-FLyZqxk_.js";import{S as E}from"./Select-Bll8qaaM.js";import{F as p}from"./FormField-DuaIuRcX.js";import{F as G}from"./FormError-D4zmGTMi.js";import{F as Z}from"./FormActions-Do4OpoxV.js";import"./vendor-utils-DMdnf9MG.js";import"./vendor-charts-DGg1Za7c.js";import"./vendor-icons-Doz15FS9.js";function Ne({isOpen:r,onClose:_,onSuccess:y,warehouses:i,preselectedItem:c}){const{t:n}=$(),[s,u]=a.useState({product_id:0,source_warehouse_id:0,destination_warehouse_id:0,quantity:1,notes:""}),[h,m]=a.useState({}),[f,v]=a.useState(null),[b,g]=a.useState(!1),[j,S]=a.useState([]),[w,d]=a.useState(!1),[x,C]=a.useState(null),o=a.useMemo(()=>`${c?.id??"new"}-${r}`,[c?.id,r]),[N,I]=a.useState(o);o!==N&&(I(o),c?(u({product_id:c.product_id,source_warehouse_id:c.warehouse_id,destination_warehouse_id:0,quantity:1,notes:""}),C(c.available_quantity)):(u({product_id:0,source_warehouse_id:0,destination_warehouse_id:0,quantity:1,notes:""}),C(null)),m({}),v(null));const A=a.useCallback(async()=>{if(!c){d(!0);try{const l=await fe.list({per_page:100});S(l.data)}catch{}finally{d(!1)}}},[c]);a.useEffect(()=>{r&&!c&&A()},[r,c,A]);const B=a.useCallback(async()=>{if(s.product_id&&s.source_warehouse_id&&!c)try{const L=(await q.getByWarehouse(s.source_warehouse_id)).find(H=>H.product_id===s.product_id);C(L?.available_quantity??0)}catch{C(0)}},[s.product_id,s.source_warehouse_id,c]);a.useEffect(()=>{B()},[B]);const P=()=>{const l={};return s.product_id||(l.product_id=n("validation.required","This field is required")),s.source_warehouse_id||(l.source_warehouse_id=n("validation.required","This field is required")),s.destination_warehouse_id||(l.destination_warehouse_id=n("validation.required","This field is required")),s.source_warehouse_id===s.destination_warehouse_id&&(l.destination_warehouse_id=n("inventory.same_warehouse","Source and destination must be different")),s.quantity<=0&&(l.quantity=n("validation.positive","Must be greater than 0")),x!==null&&s.quantity>x&&(l.quantity=n("inventory.insufficient_stock","Insufficient stock available")),m(l),Object.keys(l).length===0},U=async l=>{if(l.preventDefault(),!!P()){g(!0),v(null);try{await q.createTransfer(s),k.success(n("inventory.transfer_created","Stock transfer initiated")),y()}catch(L){v(L instanceof Error?L.message:n("error.save_failed","Failed to create transfer"))}finally{g(!1)}}},M=j.map(l=>({value:l.id,label:`${l.sku} - ${l.name}`})),Q=i.filter(l=>l.is_active).map(l=>({value:l.id,label:l.name})),T=i.filter(l=>l.is_active&&l.id!==s.source_warehouse_id).map(l=>({value:l.id,label:l.name}));return e.jsx(W,{isOpen:r,onClose:_,title:n("inventory.transfer_stock","Transfer Stock"),size:"md",children:e.jsxs("form",{onSubmit:U,children:[f&&e.jsx(G,{message:f}),c?e.jsxs("div",{className:"mb-4 p-4 rounded-lg",style:{backgroundColor:"var(--color-gray-50)"},children:[e.jsx("div",{className:"font-medium",style:{color:"var(--color-gray-900)"},children:c.product?.name}),e.jsxs("div",{className:"text-sm",style:{color:"var(--color-gray-500)"},children:["SKU: ",c.product?.sku]})]}):e.jsx(p,{label:n("inventory.product","Product"),error:h.product_id,required:!0,children:w?e.jsx("div",{className:"py-2",children:e.jsx(O,{size:"sm"})}):e.jsx(E,{value:s.product_id,onChange:l=>u({...s,product_id:l}),options:M,placeholder:n("inventory.select_product","Select product")})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(p,{label:n("inventory.source_warehouse","From Warehouse"),error:h.source_warehouse_id,required:!0,children:e.jsx(E,{value:s.source_warehouse_id,onChange:l=>u({...s,source_warehouse_id:l,destination_warehouse_id:s.destination_warehouse_id===l?0:s.destination_warehouse_id}),options:Q,placeholder:n("inventory.select_warehouse","Select"),disabled:!!c})}),e.jsx(p,{label:n("inventory.destination_warehouse","To Warehouse"),error:h.destination_warehouse_id,required:!0,children:e.jsx(E,{value:s.destination_warehouse_id,onChange:l=>u({...s,destination_warehouse_id:l}),options:T,placeholder:n("inventory.select_warehouse","Select")})})]}),e.jsx(p,{label:n("inventory.quantity","Quantity"),error:h.quantity,required:!0,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"number",min:"1",max:x??void 0,value:s.quantity,onChange:l=>u({...s,quantity:parseInt(l.target.value)||0}),className:`input flex-1 ${h.quantity?"input-error":""}`}),x!==null&&e.jsxs(D,{variant:x>0?"success":"danger",children:[n("inventory.available","Available"),": ",x]})]})}),e.jsx(p,{label:n("inventory.notes","Notes"),children:e.jsx("textarea",{value:s.notes||"",onChange:l=>u({...s,notes:l.target.value||null}),className:"input",rows:2,placeholder:n("inventory.transfer_notes_placeholder","Optional transfer notes...")})}),s.source_warehouse_id>0&&s.destination_warehouse_id>0&&s.quantity>0&&e.jsx("div",{className:"mb-4 p-4 rounded-lg",style:{backgroundColor:"var(--color-primary-50)"},children:e.jsxs("div",{className:"flex items-center justify-center gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{style:{color:"var(--color-gray-500)"},children:n("inventory.from","From")}),e.jsx("div",{className:"font-semibold",style:{color:"var(--color-gray-900)"},children:i.find(l=>l.id===s.source_warehouse_id)?.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-6 h-6",style:{color:"var(--color-primary-600)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14 5l7 7m0 0l-7 7m7-7H3"})}),e.jsx("span",{className:"font-bold text-lg",style:{color:"var(--color-primary-700)"},children:s.quantity})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{style:{color:"var(--color-gray-500)"},children:n("inventory.to","To")}),e.jsx("div",{className:"font-semibold",style:{color:"var(--color-gray-900)"},children:i.find(l=>l.id===s.destination_warehouse_id)?.name})]})]})}),e.jsx(Z,{onCancel:_,isSubmitting:b,submitLabel:n("inventory.create_transfer","Create Transfer")})]})})}function ke({isOpen:r,onClose:_,onSuccess:y,warehouse:i}){const{t:c}=$(),n=!!i,[s,u]=a.useState({name:"",code:"",address:"",is_active:!0}),[h,m]=a.useState({}),[f,v]=a.useState(null),[b,g]=a.useState(!1),j=a.useMemo(()=>`${i?.id??"new"}-${r}`,[i?.id,r]),[S,w]=a.useState(j);j!==S&&(w(j),u(i?{name:i.name,code:i.code,address:i.address||"",is_active:i.is_active}:{name:"",code:"",address:"",is_active:!0}),m({}),v(null));const d=()=>{const o={};return s.name.trim()||(o.name=c("validation.required","This field is required")),s.code.trim()?/^[A-Z0-9_-]+$/i.test(s.code)||(o.code=c("validation.alphanumeric","Only letters, numbers, and dashes allowed")):o.code=c("validation.required","This field is required"),m(o),Object.keys(o).length===0},x=async o=>{if(o.preventDefault(),!!d()){g(!0),v(null);try{const N={...s,address:s.address?.trim()||null};n&&i?(await K.update(i.id,N),k.success(c("warehouses.updated","Warehouse updated"))):(await K.create(N),k.success(c("warehouses.created","Warehouse created"))),y()}catch(N){v(N instanceof Error?N.message:c("error.save_failed","Failed to save"))}finally{g(!1)}}},C=o=>{if(u({...s,name:o}),!n&&(!s.code||s.code===s.name.toUpperCase().replace(/\s+/g,"_").slice(0,10))){const N=o.toUpperCase().replace(/\s+/g,"_").slice(0,10);u(I=>({...I,name:o,code:N}))}};return e.jsx(W,{isOpen:r,onClose:_,title:n?c("warehouses.edit","Edit Warehouse"):c("warehouses.create","Create Warehouse"),size:"md",children:e.jsxs("form",{onSubmit:x,children:[f&&e.jsx(G,{message:f}),e.jsx(p,{label:c("warehouses.name","Warehouse Name"),error:h.name,required:!0,children:e.jsx("input",{type:"text",value:s.name,onChange:o=>C(o.target.value),className:`input ${h.name?"input-error":""}`,placeholder:c("warehouses.name_placeholder","e.g., Main Warehouse"),autoFocus:!0})}),e.jsxs(p,{label:c("warehouses.code","Code"),error:h.code,required:!0,children:[e.jsx("input",{type:"text",value:s.code,onChange:o=>u({...s,code:o.target.value.toUpperCase()}),className:`input font-mono ${h.code?"input-error":""}`,placeholder:c("warehouses.code_placeholder","e.g., MAIN_WH"),maxLength:20}),e.jsx("div",{className:"text-xs mt-1",style:{color:"var(--color-gray-500)"},children:c("warehouses.code_hint","Unique identifier for the warehouse")})]}),e.jsx(p,{label:c("warehouses.address","Address"),children:e.jsx("textarea",{value:s.address||"",onChange:o=>u({...s,address:o.target.value}),className:"input",rows:2,placeholder:c("warehouses.address_placeholder","Physical location address...")})}),e.jsx(p,{label:c("warehouses.status","Status"),children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.is_active,onChange:o=>u({...s,is_active:o.target.checked}),className:"w-5 h-5 rounded",style:{accentColor:"var(--color-primary-600)"}}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",style:{color:"var(--color-gray-900)"},children:c("warehouses.active","Active")}),e.jsx("div",{className:"text-sm",style:{color:"var(--color-gray-500)"},children:c("warehouses.active_hint","Inactive warehouses are hidden from selection")})]})]})}),e.jsx(Z,{onCancel:_,isSubmitting:b,submitLabel:n?c("common.save","Save"):c("common.create","Create")})]})})}function Se({isOpen:r,onClose:_,onResolved:y}){const{t:i,locale:c}=$(),[n,s]=a.useState([]),[u,h]=a.useState(!0),[m,f]=a.useState(null),[v,b]=a.useState("accept"),[g,j]=a.useState(""),[S,w]=a.useState(!1),d=a.useCallback(async()=>{h(!0);try{const o=await q.pendingReconciliations();s(o)}catch{k.error(i("error.load_failed","Failed to load reconciliation queue"))}finally{h(!1)}},[i]);a.useEffect(()=>{r&&d()},[r,d]);const x=async()=>{if(m){w(!0);try{await q.resolveReconciliation(m.id,{action:v,notes:g||void 0}),k.success(i("inventory.reconciliation_resolved","Conflict resolved")),f(null),j(""),d(),y?.()}catch{k.error(i("error.save_failed","Failed to resolve conflict"))}finally{w(!1)}}},C=o=>{switch(o){case"accept":return i("inventory.accept_actual","Accept Actual Count");case"adjust":return i("inventory.adjust_to_expected","Adjust to Expected");case"ignore":return i("inventory.ignore_difference","Ignore Difference")}};return e.jsx(W,{isOpen:r,onClose:_,title:i("inventory.reconciliation_queue","Reconciliation Queue"),size:"xl",children:u?e.jsx("div",{className:"py-12",children:e.jsx(O,{})}):n.length===0?e.jsx(be,{icon:"âœ…",title:i("inventory.no_conflicts","No Conflicts"),description:i("inventory.no_conflicts_desc","All stock levels are synchronized")}):m?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>f(null),className:"flex items-center gap-2 text-sm",style:{color:"var(--color-primary-600)"},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),i("common.back","Back")]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--color-gray-50)"},children:[e.jsx("div",{className:"font-medium mb-2",style:{color:"var(--color-gray-900)"},children:m.product?.name}),e.jsx("div",{className:"text-sm",style:{color:"var(--color-gray-500)"},children:m.warehouse?.name}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs",style:{color:"var(--color-gray-500)"},children:i("inventory.expected","Expected")}),e.jsx("div",{className:"text-xl font-semibold",style:{color:"var(--color-gray-900)"},children:m.expected_quantity})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs",style:{color:"var(--color-gray-500)"},children:i("inventory.actual","Actual")}),e.jsx("div",{className:"text-xl font-semibold",style:{color:"var(--color-primary-600)"},children:m.actual_quantity})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs",style:{color:"var(--color-gray-500)"},children:i("inventory.difference","Difference")}),e.jsxs("div",{className:"text-xl font-semibold",style:{color:m.difference>0?"var(--color-success-600)":"var(--color-error-600)"},children:[m.difference>0?"+":"",m.difference]})]})]})]}),e.jsx(p,{label:i("inventory.resolution_action","Resolution Action"),children:e.jsx("div",{className:"space-y-2",children:["accept","adjust","ignore"].map(o=>e.jsxs("label",{className:"flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-colors",style:{borderColor:v===o?"var(--color-primary-500)":"var(--color-gray-200)",backgroundColor:v===o?"var(--color-primary-50)":"transparent"},children:[e.jsx("input",{type:"radio",name:"resolution",value:o,checked:v===o,onChange:()=>b(o),className:"w-4 h-4",style:{accentColor:"var(--color-primary-600)"}}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",style:{color:"var(--color-gray-900)"},children:C(o)}),e.jsxs("div",{className:"text-sm",style:{color:"var(--color-gray-500)"},children:[o==="accept"&&i("inventory.accept_desc","Use the actual counted quantity as the new stock level"),o==="adjust"&&i("inventory.adjust_desc","Create an adjustment to restore the expected quantity"),o==="ignore"&&i("inventory.ignore_desc","Mark as reviewed but take no action")]})]})]},o))})}),e.jsx(p,{label:i("inventory.resolution_notes","Notes"),children:e.jsx("textarea",{value:g,onChange:o=>j(o.target.value),className:"input",rows:2,placeholder:i("inventory.resolution_notes_placeholder","Explain the resolution...")})}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:()=>f(null),className:"btn btn-secondary flex-1",disabled:S,children:i("common.cancel","Cancel")}),e.jsx("button",{onClick:x,className:"btn btn-primary flex-1",disabled:S,children:S?e.jsx(O,{size:"sm"}):i("inventory.resolve","Resolve")})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("span",{className:"text-sm",style:{color:"var(--color-gray-500)"},children:[n.length," ",i("inventory.pending_conflicts","pending conflicts")]}),e.jsx(D,{variant:"warning",children:n.length})]}),n.map(o=>e.jsx("button",{onClick:()=>f(o),className:"w-full p-4 rounded-lg border text-start transition-colors hover:border-primary-300",style:{borderColor:"var(--color-gray-200)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",style:{color:"var(--color-gray-900)"},children:o.product?.name}),e.jsxs("div",{className:"text-sm",style:{color:"var(--color-gray-500)"},children:[o.product?.sku," â€¢ ",o.warehouse?.name]})]}),e.jsxs("div",{className:"text-end",children:[e.jsxs(D,{variant:o.difference>0?"success":"danger",children:[o.difference>0?"+":"",o.difference]}),e.jsx("div",{className:"text-xs mt-1",style:{color:"var(--color-gray-400)"},children:new Date(o.created_at).toLocaleDateString(c)})]})]})},o.id))]})})}const Ce=[{value:"stock_count",label:"Stock Count"},{value:"damage",label:"Damaged Goods"},{value:"theft",label:"Theft/Loss"},{value:"return",label:"Customer Return"},{value:"correction",label:"Correction"},{value:"initial",label:"Initial Stock"},{value:"other",label:"Other"}];function Oe(){const{t:r,locale:_}=$(),{hasPermission:y}=ge(),i=y("inventory.adjust"),c=y("inventory.transfer"),n=y("warehouses.manage"),[s,u]=a.useState([]),[h,m]=a.useState([]),[f,v]=a.useState(!0),[b,g]=a.useState({currentPage:1,totalPages:1,totalItems:0,perPage:15}),[j,S]=a.useState(""),[w,d]=a.useState(null),[x,C]=a.useState(!1),[o,N]=a.useState(null),[I,A]=a.useState(null),[B,P]=a.useState(!1),[U,M]=a.useState(!1),[Q,T]=a.useState(null),[l,L]=a.useState(!1),[H,V]=a.useState(null),[ae,J]=a.useState(!1),[oe,X]=a.useState(!1),[Y,ne]=a.useState([]),[le,ee]=a.useState(!1),[ie,se]=a.useState(!1),[te,ce]=a.useState([]),[de,re]=a.useState(!1),R=a.useCallback(async()=>{v(!0);try{const t={page:b.currentPage,per_page:b.perPage,search:j||void 0,warehouse_id:w,low_stock_only:x||void 0},F=await q.list(t);u(F.data),g(pe=>({...pe,currentPage:F.meta.current_page,totalPages:F.meta.last_page,totalItems:F.meta.total}))}catch{k.error(r("error.load_failed","Failed to load inventory"))}finally{v(!1)}},[b.currentPage,b.perPage,j,w,x,r]),z=a.useCallback(async()=>{try{const t=await K.list();m(t)}catch{}},[]),ue=async()=>{ee(!0);try{const t=await q.transfers({page:1});ne(t.data)}catch{k.error(r("error.load_failed","Failed to load transfers"))}finally{ee(!1)}},he=async()=>{if(H)try{await K.delete(H),k.success(r("warehouses.deleted","Warehouse deleted")),V(null),z()}catch{k.error(r("error.delete_failed","Failed to delete warehouse"))}},me=async()=>{re(!0);try{const t=await q.adjustments({page:1});ce(t.data)}catch{k.error(r("error.load_failed","Failed to load history"))}finally{re(!1)}};a.useEffect(()=>{R()},[R]),a.useEffect(()=>{z()},[z]),a.useEffect(()=>{g(t=>({...t,currentPage:1}))},[j,w,x]);const ye=[{key:"sku",header:r("products.sku","SKU"),width:"120px",render:t=>e.jsx("span",{className:"font-mono text-sm",style:{color:"var(--color-gray-600)"},children:t.product?.sku})},{key:"name",header:r("products.name","Product"),render:t=>e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",style:{color:"var(--color-gray-900)"},children:t.product?.name}),t.product?.barcode&&e.jsx("div",{className:"text-xs",style:{color:"var(--color-gray-500)"},children:t.product?.barcode})]})},{key:"warehouse",header:r("inventory.warehouse","Warehouse"),hideOnMobile:!0,render:t=>e.jsx("span",{style:{color:"var(--color-gray-600)"},children:t.warehouse?.name||"-"})},{key:"quantity",header:r("inventory.quantity","Qty"),align:"end",width:"100px",render:t=>e.jsx("span",{className:"font-semibold",style:{color:t.is_low_stock?"var(--color-error-600)":"var(--color-gray-900)"},children:t.quantity})},{key:"available",header:r("inventory.available","Available"),align:"end",hideOnMobile:!0,width:"100px",render:t=>e.jsx("span",{style:{color:"var(--color-gray-600)"},children:t.available_quantity})},{key:"status",header:r("inventory.status","Status"),align:"center",width:"120px",render:t=>t.quantity===0?e.jsx(D,{variant:"danger",dot:!0,children:r("inventory.out_of_stock","Out of Stock")}):t.is_low_stock?e.jsx(D,{variant:"warning",dot:!0,children:r("inventory.low_stock","Low Stock")}):e.jsx(D,{variant:"success",dot:!0,children:r("inventory.in_stock","In Stock")})}],ve=t=>e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[i&&e.jsx("button",{onClick:()=>N(t),className:"btn btn-ghost p-2",title:r("inventory.adjust","Adjust Stock"),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),c&&t.available_quantity>0&&e.jsx("button",{onClick:()=>{A(t),P(!0)},className:"btn btn-ghost p-2",title:r("inventory.transfer","Transfer Stock"),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})})]}),xe=[{value:"",label:r("common.all_warehouses","All Warehouses")},...h.map(t=>({value:t.id,label:t.name}))];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl font-semibold",style:{color:"var(--color-gray-900)"},children:r("nav.inventory","Inventory")}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[n&&e.jsxs("button",{onClick:()=>L(!0),className:"btn btn-secondary",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),r("inventory.warehouses","Warehouses")]}),c&&e.jsxs("button",{onClick:()=>{X(!0),ue()},className:"btn btn-secondary",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),r("inventory.transfers","Transfers")]}),e.jsxs("button",{onClick:()=>J(!0),className:"btn btn-secondary",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),r("inventory.reconciliation","Reconciliation")]}),e.jsxs("button",{onClick:()=>{se(!0),me()},className:"btn btn-secondary",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),r("inventory.history","History")]})]})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(je,{value:j,onChange:S,placeholder:r("inventory.search_placeholder","Search by product name or SKU...")})}),e.jsx("div",{className:"w-full lg:w-48",children:e.jsx(E,{value:w,onChange:t=>d(t),options:xe,clearable:!0})}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer px-4 py-2 rounded-lg border",style:{borderColor:"var(--color-gray-300)"},children:[e.jsx("input",{type:"checkbox",checked:x,onChange:t=>C(t.target.checked),className:"w-4 h-4 rounded",style:{accentColor:"var(--color-primary-600)"}}),e.jsx("span",{style:{color:"var(--color-gray-700)"},children:r("inventory.low_stock_only","Low stock only")})]})]})}),e.jsx("div",{className:"card p-0",children:e.jsx(we,{columns:ye,data:s,keyExtractor:t=>t.id,isLoading:f,emptyIcon:"ðŸ“¦",emptyTitle:r("inventory.empty","No inventory found"),emptyDescription:r("inventory.empty_desc","Stock data will appear here once products are added"),rowActions:i?ve:void 0,pagination:{...b,onPageChange:t=>g(F=>({...F,currentPage:t}))}})}),e.jsx(qe,{isOpen:o!==null,onClose:()=>N(null),item:o,warehouses:h,onSuccess:()=>{N(null),R()}}),e.jsx(W,{isOpen:ie,onClose:()=>se(!1),title:r("inventory.history","Adjustment History"),size:"xl",children:de?e.jsx("div",{className:"py-8",children:e.jsx(O,{})}):te.length===0?e.jsx("div",{className:"py-8 text-center",style:{color:"var(--color-gray-500)"},children:r("inventory.no_history","No adjustments recorded yet")}):e.jsx("div",{className:"space-y-3",children:te.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border",style:{borderColor:"var(--color-gray-200)"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",style:{color:"var(--color-gray-900)"},children:t.product?.name}),e.jsxs("div",{className:"text-sm",style:{color:"var(--color-gray-500)"},children:[t.reason," â€¢ ",t.user?.name]}),t.notes&&e.jsx("div",{className:"text-sm",style:{color:"var(--color-gray-400)"},children:t.notes})]}),e.jsxs("div",{className:"text-end",children:[e.jsxs("span",{className:"font-semibold",style:{color:t.type==="increase"?"var(--color-success-600)":t.type==="decrease"?"var(--color-error-600)":"var(--color-gray-900)"},children:[t.type==="increase"?"+":t.type==="decrease"?"-":"=",t.quantity]}),e.jsx("div",{className:"text-xs",style:{color:"var(--color-gray-400)"},children:new Date(t.created_at).toLocaleString(_)})]})]},t.id))})}),e.jsx(Ne,{isOpen:B,onClose:()=>{P(!1),A(null)},preselectedItem:I,warehouses:h,onSuccess:()=>{P(!1),A(null),R()}}),e.jsx(ke,{isOpen:U,onClose:()=>{M(!1),T(null)},warehouse:Q,onSuccess:()=>{M(!1),T(null),z()}}),e.jsx(W,{isOpen:l,onClose:()=>L(!1),title:r("inventory.warehouses","Warehouses"),size:"lg",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx("button",{onClick:()=>{T(null),M(!0)},className:"btn btn-primary",children:r("inventory.add_warehouse","Add Warehouse")})}),h.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border",style:{borderColor:"var(--color-gray-200)"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",style:{color:"var(--color-gray-900)"},children:t.name}),e.jsxs("div",{className:"text-sm",style:{color:"var(--color-gray-500)"},children:[t.code," ",t.address&&`â€¢ ${t.address}`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${t.is_active?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"}`,children:t.is_active?r("common.active","Active"):r("common.inactive","Inactive")}),e.jsx("button",{onClick:()=>{T(t),M(!0)},className:"p-2 rounded-lg hover:bg-gray-100",title:r("common.edit","Edit"),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>V(t.id),className:"p-2 rounded-lg hover:bg-red-100 text-red-600",title:r("common.delete","Delete"),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},t.id))]})}),e.jsx(W,{isOpen:oe,onClose:()=>X(!1),title:r("inventory.transfers","Stock Transfers"),size:"xl",children:le?e.jsx("div",{className:"py-8",children:e.jsx(O,{})}):Y.length===0?e.jsx("div",{className:"py-8 text-center",style:{color:"var(--color-gray-500)"},children:r("inventory.no_transfers","No transfers recorded yet")}):e.jsx("div",{className:"space-y-3",children:Y.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border",style:{borderColor:"var(--color-gray-200)"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",style:{color:"var(--color-gray-900)"},children:t.product?.name}),e.jsxs("div",{className:"text-sm",style:{color:"var(--color-gray-500)"},children:[t.source_warehouse?.name," â†’ ",t.destination_warehouse?.name]}),e.jsxs("div",{className:"text-sm",style:{color:"var(--color-gray-400)"},children:[r("inventory.quantity","Quantity"),": ",t.quantity,t.notes&&` â€¢ ${t.notes}`]})]}),e.jsxs("div",{className:"text-end",children:[e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${t.status==="completed"?"bg-green-100 text-green-700":t.status==="pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:t.status}),e.jsx("div",{className:"text-xs mt-1",style:{color:"var(--color-gray-400)"},children:new Date(t.created_at).toLocaleString(_)})]})]},t.id))})}),e.jsx(Se,{isOpen:ae,onClose:()=>{J(!1),R()}}),e.jsx(_e,{isOpen:H!==null,onClose:()=>V(null),onConfirm:he,title:r("inventory.delete_warehouse","Delete Warehouse"),message:r("inventory.delete_warehouse_confirm","Are you sure you want to delete this warehouse? This action cannot be undone."),confirmLabel:r("common.delete","Delete"),variant:"danger"})]})}function qe({isOpen:r,onClose:_,item:y,warehouses:i,onSuccess:c}){const{t:n}=$(),[s,u]=a.useState({product_id:0,warehouse_id:0,quantity:0,type:"increase",reason:"stock_count",notes:""}),[h,m]=a.useState({}),[f,v]=a.useState(null),[b,g]=a.useState(!1);a.useEffect(()=>{y&&u({product_id:y.product_id,warehouse_id:y.warehouse_id,quantity:0,type:"increase",reason:"stock_count",notes:""}),m({}),v(null)},[y,r]);const j=()=>{const d={};return s.quantity<=0&&s.type!=="set"&&(d.quantity=n("validation.positive","Must be greater than 0")),s.type==="set"&&s.quantity<0&&(d.quantity=n("validation.non_negative","Cannot be negative")),m(d),Object.keys(d).length===0},S=async d=>{if(d.preventDefault(),!!j()){g(!0),v(null);try{await q.adjust(s),k.success(n("inventory.adjusted","Stock adjusted successfully")),c()}catch(x){v(x instanceof Error?x.message:n("error.save_failed","Failed to save"))}finally{g(!1)}}},w=[{value:"increase",label:n("inventory.increase","Increase (+)")},{value:"decrease",label:n("inventory.decrease","Decrease (-)")},{value:"set",label:n("inventory.set","Set to Value")}];return e.jsx(W,{isOpen:r,onClose:_,title:n("inventory.adjust_stock","Adjust Stock"),size:"md",children:y&&e.jsxs("form",{onSubmit:S,children:[f&&e.jsx(G,{message:f}),e.jsxs("div",{className:"mb-4 p-4 rounded-lg",style:{backgroundColor:"var(--color-gray-50)"},children:[e.jsx("div",{className:"font-medium",style:{color:"var(--color-gray-900)"},children:y.product?.name}),e.jsxs("div",{className:"text-sm",style:{color:"var(--color-gray-500)"},children:[n("inventory.current_stock","Current stock"),": ",e.jsx("strong",{children:y.quantity})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(p,{label:n("inventory.adjustment_type","Type"),children:e.jsx(E,{value:s.type,onChange:d=>u({...s,type:d||"increase"}),options:w})}),e.jsx(p,{label:n("inventory.quantity","Quantity"),error:h.quantity,children:e.jsx("input",{type:"number",min:"0",value:s.quantity,onChange:d=>u({...s,quantity:parseInt(d.target.value)||0}),className:`input ${h.quantity?"input-error":""}`})})]}),e.jsx(p,{label:n("inventory.warehouse","Warehouse"),children:e.jsx(E,{value:s.warehouse_id,onChange:d=>u({...s,warehouse_id:d}),options:i.map(d=>({value:d.id,label:d.name}))})}),e.jsx(p,{label:n("inventory.reason","Reason"),children:e.jsx(E,{value:s.reason,onChange:d=>u({...s,reason:d||"stock_count"}),options:Ce})}),e.jsx(p,{label:n("inventory.notes","Notes"),children:e.jsx("textarea",{value:s.notes||"",onChange:d=>u({...s,notes:d.target.value||null}),className:"input",rows:2,placeholder:n("inventory.notes_placeholder","Optional notes...")})}),e.jsx("div",{className:"mb-4 p-4 rounded-lg",style:{backgroundColor:"var(--color-primary-50)"},children:e.jsxs("div",{className:"text-sm",style:{color:"var(--color-primary-700)"},children:[n("inventory.new_stock","New stock will be"),":"," ",e.jsx("strong",{children:s.type==="set"?s.quantity:s.type==="increase"?y.quantity+s.quantity:Math.max(0,y.quantity-s.quantity)})]})}),e.jsx(Z,{onCancel:_,isSubmitting:b,submitLabel:n("inventory.apply","Apply Adjustment")})]})})}export{Oe as InventoryPage,Oe as default};
