import{a as W,j as e,c as Y,m as E,b as ne,B as ge,e as ue,p as re,L as G,t as M,s as be,O as ye,P as ke}from"./index-JnHVxLbD.js";import{r as s}from"./vendor-react-DsCSLZ3L.js";import{A as me,M as Q}from"./Modal-D5rG5aoT.js";import{i as ve}from"./vendor-utils-DMdnf9MG.js";import{D as je,l as xe,W as pe,m as oe,n as le,B as ie,j as we,a as Ne,Q as Ce,b as _e,o as Se}from"./vendor-icons-DU-kWQ55.js";import{F as Le}from"./FormError-BBWAzQth.js";import"./vendor-charts-DGg1Za7c.js";function ze(t,x={}){const{enabled:p=!0,preventDefault:n=!0}=x,r=s.useRef(t);s.useEffect(()=>{r.current=t},[t]);const a=s.useCallback(c=>{if(!p)return;const i=c.target,k=["INPUT","TEXTAREA","SELECT"].includes(i.tagName),v=i.isContentEditable,w=c.key.startsWith("F")&&c.key.length<=3;if(!((k||v)&&!w))for(const g of r.current){if(g.disabled)continue;const L=c.key.toLowerCase()===g.key.toLowerCase(),b=!!g.ctrl===(c.ctrlKey||c.metaKey),y=!!g.shift===c.shiftKey,_=!!g.alt===c.altKey;if(L&&b&&y&&_){n&&c.preventDefault(),g.action();return}}},[p,n]);s.useEffect(()=>(window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)),[a])}function Re(t){const x=[{key:"F1",action:t.onHelp||(()=>{}),description:"Help / Show shortcuts",disabled:!t.onHelp},{key:"F2",action:t.onSearch||(()=>{}),description:"Search products",disabled:!t.onSearch},{key:"F3",action:t.onCustomer||(()=>{}),description:"Select customer",disabled:!t.onCustomer},{key:"F4",action:t.onDiscount||(()=>{}),description:"Apply discount",disabled:!t.onDiscount},{key:"F5",action:t.onHoldSale||(()=>{}),description:"Hold current sale",disabled:!t.onHoldSale},{key:"F6",action:t.onRecallSale||(()=>{}),description:"Recall held sale",disabled:!t.onRecallSale},{key:"F7",action:t.onVoid||(()=>{}),description:"Void item",disabled:!t.onVoid},{key:"F8",action:t.onClearCart||(()=>{}),description:"Clear cart",disabled:!t.onClearCart},{key:"F9",action:t.onReprint||(()=>{}),description:"Reprint last receipt",disabled:!t.onReprint},{key:"F10",action:t.onSettings||(()=>{}),description:"POS settings",disabled:!t.onSettings},{key:"F12",action:t.onCheckout||(()=>{}),description:"Checkout / Pay",disabled:!t.onCheckout},{key:"n",ctrl:!0,action:t.onNewSale||(()=>{}),description:"New sale",disabled:!t.onNewSale}];return ze(x),x.filter(p=>!p.disabled)}const ce="pos_print_queue",se=80,ae=288,Me=7,Ee=Math.floor(ae/Me);function Pe(t={}){const{thermalWidth:x=ae,maxRetries:p=3,autoRetry:n=!0}=t,[r,a]=s.useState({isAvailable:!0,isOnline:!0,type:"unknown"}),[c,i]=s.useState([]),[k,v]=s.useState(!1);s.useEffect(()=>{try{const o=localStorage.getItem(ce);if(o){const d=JSON.parse(o).map(h=>({...h,createdAt:new Date(h.createdAt)}));i(d.filter(h=>h.status==="pending"||h.status==="failed"))}}catch(o){console.error("Failed to load print queue:",o)}},[]),s.useEffect(()=>{try{localStorage.setItem(ce,JSON.stringify(c))}catch(o){console.error("Failed to save print queue:",o)}},[c]);const w=s.useCallback(async()=>{const o=typeof window<"u"&&typeof window.print=="function",l=navigator.onLine,d={isAvailable:o,isOnline:l,type:"unknown"};return a(d),d},[]),g=s.useCallback((o,l,d="ltr")=>`
<!DOCTYPE html>
<html dir="${d}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=${x}">
  <title>Receipt - ${l}</title>
  <style>
    @page {
      size: ${se}mm auto;
      margin: 0;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Courier New', 'Lucida Console', Monaco, monospace;
      font-size: 12px;
      line-height: 1.3;
      width: ${x}px;
      max-width: ${x}px;
      padding: 8px;
      direction: ${d};
      background: white;
      color: black;
    }
    .receipt-header {
      text-align: center;
      margin-bottom: 8px;
      border-bottom: 1px dashed #000;
      padding-bottom: 8px;
    }
    .receipt-header h1 {
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 4px;
    }
    .receipt-header p {
      font-size: 11px;
    }
    .receipt-info {
      margin: 8px 0;
      font-size: 11px;
    }
    .receipt-info-row {
      display: flex;
      justify-content: space-between;
    }
    .receipt-divider {
      border-top: 1px dashed #000;
      margin: 8px 0;
    }
    .receipt-items {
      margin: 8px 0;
    }
    .receipt-item {
      margin-bottom: 4px;
      font-size: 11px;
    }
    .receipt-item-name {
      font-weight: bold;
    }
    .receipt-item-details {
      display: flex;
      justify-content: space-between;
      padding-${d==="rtl"?"right":"left"}: 8px;
    }
    .receipt-totals {
      border-top: 1px dashed #000;
      margin-top: 8px;
      padding-top: 8px;
    }
    .receipt-total-row {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
    }
    .receipt-total-row.grand-total {
      font-size: 14px;
      font-weight: bold;
      margin-top: 4px;
      padding-top: 4px;
      border-top: 1px solid #000;
    }
    .receipt-footer {
      text-align: center;
      margin-top: 12px;
      padding-top: 8px;
      border-top: 1px dashed #000;
      font-size: 10px;
    }
    .receipt-qr {
      text-align: center;
      margin: 12px 0;
    }
    .receipt-qr img {
      max-width: 100px;
      height: auto;
    }
    .tabular-nums {
      font-variant-numeric: tabular-nums;
    }
    @media print {
      body {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
      @page {
        size: ${se}mm auto;
        margin: 0;
      }
    }
  </style>
</head>
<body>
  ${o}
  <script>
    window.onload = function() {
      setTimeout(function() {
        window.print();
        window.onafterprint = function() {
          window.close();
        };
      }, 100);
    };
  <\/script>
</body>
</html>`,[x]),L=s.useCallback((o,l)=>{const d={id:`print-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,html:o,invoiceNumber:l,createdAt:new Date,status:"pending",retries:0};i(h=>[...h,d])},[]),b=s.useCallback(async(o,l,d="ltr")=>{v(!0);try{const h=g(o,l,d),N=window.open("","_blank",`width=${x},height=600,scrollbars=yes`);return N?(N.document.write(h),N.document.close(),v(!1),!0):(console.warn("Print popup blocked, adding to queue"),L(o,l),!1)}catch(h){return console.error("Print failed:",h),L(o,l),v(!1),!1}},[g,x,L]),y=s.useCallback(async()=>{const o=c.filter(l=>l.status==="pending"||l.status==="failed"&&l.retries<p);for(const l of o){i(h=>h.map(N=>N.id===l.id?{...N,status:"printing"}:N));const d=await b(l.html,l.invoiceNumber);i(h=>h.map(N=>N.id===l.id?{...N,status:d?"completed":"failed",retries:N.retries+(d?0:1)}:N))}},[c,p,b]),_=s.useCallback(o=>{i(l=>l.filter(d=>d.id!==o))},[]),z=s.useCallback(()=>{i(o=>o.filter(l=>l.status!=="completed"))},[]),C=s.useCallback(()=>{i([])},[]),j=s.useCallback(o=>{i(l=>l.map(d=>d.id===o?{...d,status:"pending",retries:0}:d))},[]);return s.useEffect(()=>{n&&r.isOnline&&c.some(o=>o.status==="pending")&&y()},[n,r.isOnline,c,y]),s.useEffect(()=>{const o=()=>{a(d=>({...d,isOnline:!0}))},l=()=>{a(d=>({...d,isOnline:!1}))};return window.addEventListener("online",o),window.addEventListener("offline",l),()=>{window.removeEventListener("online",o),window.removeEventListener("offline",l)}},[]),{printerStatus:r,isPrinting:k,printQueue:c,pendingCount:c.filter(o=>o.status==="pending").length,failedCount:c.filter(o=>o.status==="failed").length,THERMAL_WIDTH_MM:se,THERMAL_WIDTH_PX:ae,MAX_CHARS_PER_LINE:Ee,print:b,checkPrinterStatus:w,addToQueue:L,processQueue:y,removeFromQueue:_,clearCompleted:z,clearQueue:C,retryJob:j,generateThermalHTML:g}}function He({onScan:t,enabled:x=!0,minLength:p=3,maxDelay:n=50}){const r=s.useRef(""),a=s.useRef(0),c=s.useCallback(i=>{if(!x)return;const k=i.target,v=k.tagName==="INPUT"||k.tagName==="TEXTAREA"||k.isContentEditable,w=Date.now(),g=w-a.current;if(g>n&&r.current.length>0&&(r.current=""),a.current=w,i.key==="Enter"){r.current.length>=p&&(i.preventDefault(),i.stopPropagation(),t(r.current)),r.current="";return}if(i.key.length===1&&!i.ctrlKey&&!i.altKey&&!i.metaKey){if(v&&g>n)return;(g<=n||r.current.length===0)&&(!v||g<=n)&&(r.current+=i.key)}},[x,p,n,t]);return s.useEffect(()=>{if(x)return document.addEventListener("keydown",c,{capture:!0}),()=>{document.removeEventListener("keydown",c,{capture:!0})}},[x,c]),s.useEffect(()=>{x||(r.current="")},[x]),{clearBuffer:()=>{r.current=""}}}function Te({onKeyPress:t,onClear:x,onEnter:p,onBackspace:n,className:r,showEnter:a=!0}){const{t:c}=W(),i=["1","2","3","4","5","6","7","8","9",".","0"];return e.jsxs("div",{className:Y("grid grid-cols-3 gap-3",r),role:"group","aria-label":c("common.numeric_keypad","Numeric keypad"),children:[i.map(k=>e.jsx(E.button,{whileTap:{scale:.95},onClick:()=>t(k),"aria-label":k==="."?c("common.decimal_point","Decimal point"):k,className:"h-12 min-h-[48px] min-w-[48px] rounded-xl bg-white dark:bg-zinc-800 border border-gray-200 dark:border-zinc-700 text-xl font-semibold text-gray-900 dark:text-gray-100 shadow-sm hover:bg-gray-50 dark:hover:bg-zinc-700 active:bg-gray-100 dark:active:bg-zinc-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 touch-manipulation",children:k},k)),e.jsx(E.button,{whileTap:{scale:.95},onClick:n,"aria-label":c("common.delete_last","Delete last digit"),className:"h-12 min-h-[48px] min-w-[48px] flex items-center justify-center rounded-xl bg-gray-100 dark:bg-zinc-800 border border-gray-200 dark:border-zinc-700 text-gray-900 dark:text-gray-100 shadow-sm hover:bg-gray-200 dark:hover:bg-zinc-700 active:bg-gray-300 dark:active:bg-zinc-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 touch-manipulation",children:e.jsx(je,{className:"w-7 h-7"})}),e.jsx(E.button,{whileTap:{scale:.95},onClick:x,"aria-label":c("common.clear_all","Clear all"),className:"h-12 min-h-[48px] min-w-[48px] col-span-1 rounded-xl bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-900 text-red-600 dark:text-red-400 font-semibold text-lg shadow-sm hover:bg-red-100 dark:hover:bg-red-900/30 active:bg-red-200 dark:active:bg-red-900/40 transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 touch-manipulation",children:"C"}),a&&e.jsx(E.button,{whileTap:{scale:.95},onClick:p,"aria-label":c("common.confirm","Confirm"),className:"h-12 min-h-[48px] col-span-2 flex items-center justify-center rounded-xl bg-blue-600 text-white shadow-md hover:bg-blue-700 active:bg-blue-800 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 touch-manipulation",children:e.jsx(xe,{className:"w-7 h-7"})})]})}function Fe({onCheckout:t,onHold:x,onClear:p,onRecall:n,hasHeldSales:r}){const{t:a,locale:c}=W(),{cart:i,getTotals:k,updateQuantity:v,removeItem:w,setCartDiscount:g,setCustomer:L}=ne(),b=s.useRef(null),y=i.items,_=i.customer,z=i.discount,C=k();s.useEffect(()=>{b.current&&(b.current.scrollTop=b.current.scrollHeight)},[y.length]);const j=l=>new Intl.NumberFormat(c==="ar"?"ar-LY":"en-LY",{style:"currency",currency:"LYD",minimumFractionDigits:3}).format(l),o=y.length===0?a("pos.cart_empty","Cart is empty"):`${y.length} ${a("pos.items","items")}, ${a("pos.total","Total")}: ${j(C.grand_total)}`;return e.jsxs("div",{className:"flex flex-col h-full bg-white dark:bg-zinc-900 border-s border-gray-200 dark:border-zinc-800",role:"region","aria-label":a("pos.cart","Cart"),children:[e.jsx("div",{"aria-live":"polite","aria-atomic":"true",className:"sr-only",children:o}),e.jsxs("div",{className:"flex items-center justify-between px-4 sm:px-5 py-3 sm:py-4 border-b border-gray-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"font-semibold text-lg sm:text-xl text-gray-900 dark:text-gray-100",children:a("pos.cart","Cart")}),y.length>0&&e.jsx(ge,{variant:"primary",className:"text-sm px-2.5 py-1",children:y.length})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[r&&e.jsx(E.button,{whileTap:{scale:.95},onClick:n,className:"min-w-[48px] min-h-[48px] w-12 h-12 flex items-center justify-center rounded-xl bg-orange-50 text-orange-600 hover:bg-orange-100 active:bg-orange-200 dark:bg-orange-900/20 dark:text-orange-400 dark:hover:bg-orange-900/30 transition-colors touch-manipulation focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2",title:a("pos.recall","Recall Held Sale"),"aria-label":a("pos.recall","Recall Held Sale"),children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})})}),y.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(E.button,{whileTap:{scale:.95},onClick:x,className:"min-w-[48px] min-h-[48px] w-12 h-12 flex items-center justify-center rounded-xl bg-gray-100 text-gray-600 hover:bg-gray-200 active:bg-gray-300 dark:bg-zinc-800 dark:text-gray-400 dark:hover:bg-zinc-700 transition-colors touch-manipulation focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2",title:a("pos.hold","Hold Sale"),"aria-label":a("pos.hold","Hold Sale"),children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})}),e.jsx(E.button,{whileTap:{scale:.95},onClick:p,className:"min-w-[48px] min-h-[48px] w-12 h-12 flex items-center justify-center rounded-xl bg-red-50 text-red-600 hover:bg-red-100 active:bg-red-200 dark:bg-red-900/20 dark:text-red-400 dark:hover:bg-red-900/30 transition-colors touch-manipulation focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2",title:a("pos.clear","Clear Cart"),"aria-label":a("pos.clear","Clear Cart"),children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})]}),_&&e.jsxs("div",{className:"flex items-center justify-between px-4 sm:px-5 py-3 bg-blue-50 dark:bg-blue-900/20 border-b border-blue-100 dark:border-blue-900/30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-800 rounded-full text-blue-600 dark:text-blue-300",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsx("span",{className:"text-sm font-semibold text-blue-900 dark:text-blue-100",children:_.name})]}),e.jsx("button",{onClick:()=>L(null),className:"min-h-[44px] min-w-[44px] text-sm font-medium text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 uppercase tracking-wide px-3 py-2 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-800/50 transition-colors touch-manipulation","aria-label":`${a("common.remove","Remove")} ${_.name}`,children:a("common.remove","Remove")})]}),e.jsx("div",{ref:b,className:"flex-1 overflow-y-auto scroll-smooth",children:y.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8 text-center opacity-60",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 dark:bg-zinc-800 rounded-full flex items-center justify-center mb-4 text-4xl grayscale",children:"ðŸ›’"}),e.jsx("p",{className:"font-medium text-lg text-gray-900 dark:text-gray-100",children:a("pos.empty_cart","Cart is empty")}),e.jsx("p",{className:"text-sm text-gray-500 mt-2 max-w-[200px]",children:a("pos.empty_cart_hint","Scan a barcode or select products from the grid")})]}):e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-zinc-800",children:e.jsx(me,{initial:!1,children:y.map(l=>e.jsx(Ae,{item:l,onUpdateQuantity:d=>v(l.id,d),onRemove:()=>w(l.id),formatCurrency:j},l.id))})})}),e.jsxs("div",{className:"bg-gray-50 dark:bg-zinc-800/50 border-t border-gray-200 dark:border-zinc-800 p-5 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:a("pos.subtotal","Subtotal")}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:j(C.subtotal)})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:a("pos.discount","Discount")}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"0",max:"100",value:z||"",onChange:l=>g(parseFloat(l.target.value)||0,"percentage"),className:"w-16 pl-2 pr-6 py-1 text-center font-medium rounded-md border border-gray-300 dark:border-zinc-700 bg-white dark:bg-zinc-800 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"0"}),e.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 text-xs",children:"%"})]})]}),e.jsxs("span",{className:"text-red-500 font-medium",children:["-",j(C.discount_amount)]})]}),e.jsx("div",{className:"border-t border-dashed border-gray-300 dark:border-zinc-700 my-2"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-bold text-lg text-gray-900 dark:text-white",children:a("pos.total","Total")}),e.jsx("span",{className:"font-bold text-2xl text-blue-600 dark:text-blue-400",children:j(C.grand_total)})]}),e.jsxs(E.button,{whileTap:{scale:.98},onClick:t,disabled:y.length===0,className:"w-full h-[72px] min-h-[72px] flex items-center justify-between bg-gray-900 dark:bg-white text-white dark:text-black py-4 px-6 rounded-2xl font-bold text-lg shadow-lg hover:shadow-xl hover:bg-gray-800 dark:hover:bg-zinc-200 active:bg-gray-950 dark:active:bg-zinc-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:active:scale-100 transition-all mt-4 touch-manipulation focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2","aria-label":y.length>0?`${a("pos.checkout","Checkout")} ${j(C.grand_total)}`:a("pos.checkout","Checkout"),children:[e.jsx("span",{className:"text-lg sm:text-xl",children:a("pos.checkout","Checkout")}),e.jsx("span",{className:"text-lg sm:text-xl font-bold tabular-nums",children:y.length>0&&j(C.grand_total)})]})]})]})}function Ae({item:t,onUpdateQuantity:x,onRemove:p,formatCurrency:n}){const{t:r}=W();return e.jsxs(E.div,{layout:!0,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20,height:0},className:"flex items-center gap-3 px-4 sm:px-5 py-3 sm:py-4 min-h-[72px] bg-white dark:bg-zinc-900 group hover:bg-gray-50 dark:hover:bg-zinc-800/50 transition-colors",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-gray-100 truncate text-base mb-1",children:t.product.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-medium tabular-nums",children:n(t.unit_price)})]}),e.jsxs("div",{className:"flex items-center bg-gray-100 dark:bg-zinc-800 rounded-xl p-1 gap-1",children:[e.jsx(E.button,{whileTap:{scale:.9},onClick:()=>x(t.quantity-1),className:"w-11 h-11 min-w-[44px] min-h-[44px] flex items-center justify-center rounded-lg bg-white dark:bg-zinc-700 shadow-sm text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white active:bg-gray-100 dark:active:bg-zinc-600 transition-colors touch-manipulation focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":r("common.decrease","Decrease quantity"),children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M20 12H4"})})}),e.jsx("input",{type:"number",min:"1",value:t.quantity,onChange:a=>x(parseInt(a.target.value)||1),className:"w-12 h-11 text-center text-base font-bold bg-transparent border-none p-0 focus:ring-0 text-gray-900 dark:text-gray-100 tabular-nums","aria-label":r("common.quantity","Quantity")}),e.jsx(E.button,{whileTap:{scale:.9},onClick:()=>x(t.quantity+1),className:"w-11 h-11 min-w-[44px] min-h-[44px] flex items-center justify-center rounded-lg bg-blue-600 dark:bg-blue-500 shadow-sm text-white hover:bg-blue-700 dark:hover:bg-blue-600 active:bg-blue-800 dark:active:bg-blue-700 transition-colors touch-manipulation focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2","aria-label":r("common.increase","Increase quantity"),children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M12 4v16m8-8H4"})})})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1 min-w-[80px]",children:[e.jsx("p",{className:"font-bold text-gray-900 dark:text-gray-100 tabular-nums",children:n(t.unit_price*t.quantity)}),e.jsx("button",{onClick:p,className:"min-h-[32px] text-xs text-red-500 hover:text-red-700 dark:text-red-400 font-medium px-2 py-1 rounded hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors touch-manipulation","aria-label":`Remove ${t.product.name}`,children:"Remove"})]})]})}function Ie({isOpen:t,onClose:x,onSuccess:p}){const{t:n,locale:r}=W(),{cart:a,getTotals:c,clearCart:i}=ne(),{isOnline:k,createOfflineSale:v}=ue(),w=a.items,g=a.customer,L=a.discount,b=c(),[y,_]=s.useState([]),[z,C]=s.useState(!1),[j,o]=s.useState(!1),[l,d]=s.useState(null),[h,N]=s.useState([]),[A,B]=s.useState(null),[H,T]=s.useState(""),[U,V]=s.useState(""),F=u=>new Intl.NumberFormat(r==="ar"?"ar-LY":"en-LY",{style:"currency",currency:"LYD",minimumFractionDigits:3}).format(u),K=h.reduce((u,m)=>u+m.amount,0),I=Math.max(0,b.grand_total-K),X=Math.max(0,K-b.grand_total),D=I<=.001;s.useEffect(()=>{t&&(Z(),N([]),d(null),T(""))},[t]),s.useEffect(()=>{A&&I>0&&T(I.toFixed(3))},[A,h.length]);const Z=async()=>{C(!0);try{const u=await re.paymentMethods();_(u),u.length>0&&B(u[0].id)}catch(u){console.error("Failed to load payment methods:",u)}finally{C(!1)}},ee=u=>{u==="."&&H.includes(".")||T(m=>u==="."&&m===""?"0.":m.includes(".")&&m.split(".")[1].length>=3?m:m+u)},te=()=>{T(u=>u.slice(0,-1))},f=()=>{T("")},S=()=>{if(!A||!H)return;const u=parseFloat(H);isNaN(u)||u<=0||(N([...h,{method_id:A,amount:u,reference:U||void 0}]),T(""),V(""))},$=()=>{S()},O=u=>{N(h.filter((m,P)=>P!==u))},J=async()=>{if(I>.001){d(n("pos.insufficient_payment","Insufficient payment amount"));return}o(!0),d(null);const u={items:w.map(m=>({product_id:m.product.id,product_name:m.product.name,sku:m.product.sku,quantity:m.quantity,unit_price:m.unit_price,discount:m.discount||0,tax_amount:0,total:m.unit_price*m.quantity-(m.discount||0)})),payments:h.map(m=>({payment_method_id:m.method_id,amount:m.amount,reference:m.reference})),customer_id:g?.id,subtotal:b.subtotal,discount_amount:b.discount_amount,total:b.grand_total};if(!k)try{await v(u),M.success(n("pos.sale_saved_offline","Sale saved offline")),i(),p(-1);return}catch{d(n("error.offline_save_failed","Failed to save offline")),o(!1);return}try{const m={idempotency_key:`sale-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,warehouse_id:1,items:w.map(R=>({product_id:R.product.id,quantity:R.quantity,unit_price:R.unit_price,discount:R.discount,discount_type:R.discount_type})),payments:h.map(R=>({payment_method_id:R.method_id,amount:R.amount,reference:R.reference})),customer_id:g?.id,discount:L||void 0,discount_type:a.discount_type,notes:a.notes},P=await re.createSale(m);M.success(n("pos.sale_complete","Sale completed successfully")),i(),p(P.id)}catch(m){if(m instanceof Error&&m.message.includes("network"))try{await v(u),M.success(n("pos.sale_saved_offline","Network error - Sale saved offline")),i(),p(-1)}catch{d(n("error.offline_save_failed","Failed to save offline"))}else{let P=n("error.checkout_failed","Checkout failed");if(ve(m)&&m.response){const R=m.response.status,q=m.response.data;q&&q.message&&!q.message.includes("SQLSTATE")&&!q.message.includes("Exception")&&!q.message.includes("trace")?P=q.message:R===400?P=n("error.invalid_request","Invalid request. Please check your cart and try again."):R===422?P=n("error.validation_failed","Validation failed. Please check the entered data."):R===500&&(P=n("error.server_error","Server error. Please try again later."))}else m instanceof Error&&(m.message.includes("status code")||(P=m.message));d(P)}}finally{o(!1)}},he=u=>y.find(m=>m.id===u)?.name||"Unknown",fe=u=>{switch(u){case"cash":return e.jsx(ie,{className:"w-5 h-5"});case"card":return e.jsx(we,{className:"w-5 h-5"});default:return e.jsx(le,{className:"w-5 h-5"})}};return e.jsx(Q,{isOpen:t,onClose:x,title:n("pos.checkout","Checkout"),size:"5xl",children:z?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(G,{size:"lg"})}):e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 h-full overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col gap-3 overflow-hidden pr-1",children:[!k&&e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl bg-orange-50 border border-orange-200 text-orange-800",children:[e.jsx(pe,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm font-medium",children:n("pos.offline_mode_active","Offline Mode - Local Save")})]}),l&&e.jsx(Le,{message:l}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:n("pos.payment_method","Payment Method")}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:y.map(u=>e.jsxs("button",{onClick:()=>B(u.id),className:Y("flex flex-col items-center justify-center py-2 px-2 rounded-xl border transition-all text-center gap-1",A===u.id?"bg-gray-900 text-white dark:bg-zinc-100 dark:text-zinc-900 border-transparent shadow-md transform scale-[1.02]":"bg-white text-gray-600 border-gray-200 hover:bg-gray-50 dark:bg-zinc-800 dark:border-zinc-700 dark:text-gray-400 dark:hover:bg-zinc-700"),children:[fe(u.code),e.jsx("span",{className:"text-sm font-medium truncate w-full",children:u.name})]},u.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:n("pos.amount_tendered","Amount Tendered")}),e.jsxs("div",{className:Y("relative w-full h-14 bg-white dark:bg-zinc-900 rounded-xl border-2 flex items-center px-4 transition-colors",H?"border-blue-500 shadow-sm":"border-gray-200 dark:border-zinc-700"),children:[e.jsx("div",{className:"flex-1 text-3xl font-bold tracking-tight text-gray-900 dark:text-white",children:H?F(parseFloat(H)):e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"0.000"})}),H&&e.jsx("button",{onClick:f,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",children:e.jsx(oe,{className:"w-6 h-6"})})]})]}),e.jsx("div",{className:"flex-1",children:e.jsx(Te,{onKeyPress:ee,onBackspace:te,onClear:f,onEnter:$,showEnter:!0,className:"h-full"})})]}),e.jsxs("div",{className:"lg:w-[400px] flex flex-col gap-3 bg-gray-50 dark:bg-zinc-800/50 p-4 rounded-2xl border border-gray-100 dark:border-zinc-800",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-900 dark:text-gray-100",children:n("pos.summary","Summary")}),e.jsxs("div",{className:"space-y-2 pb-3 border-b border-dashed border-gray-200 dark:border-zinc-700",children:[e.jsxs("div",{className:"flex justify-between text-base text-gray-600 dark:text-gray-400",children:[e.jsx("span",{children:n("pos.subtotal","Subtotal")}),e.jsx("span",{children:F(b.subtotal)})]}),b.discount_amount>0&&e.jsxs("div",{className:"flex justify-between text-base text-red-500",children:[e.jsx("span",{children:n("pos.discount","Discount")}),e.jsxs("span",{children:["-",F(b.discount_amount)]})]}),e.jsxs("div",{className:"flex justify-between text-2xl font-bold text-gray-900 dark:text-white pt-2",children:[e.jsx("span",{children:n("pos.total","Total")}),e.jsx("span",{children:F(b.grand_total)})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-2 max-h-[150px] lg:max-h-none",children:h.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-4 text-gray-400",children:[e.jsx(le,{className:"w-8 h-8 mb-1 opacity-20"}),e.jsx("p",{className:"text-xs italic",children:n("pos.no_payments_added","No payments added yet")})]}):e.jsx(me,{children:h.map((u,m)=>e.jsxs(E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"flex items-center justify-between p-2 bg-white dark:bg-zinc-900 rounded-xl shadow-sm border border-gray-100 dark:border-zinc-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-gray-100 dark:bg-zinc-800 rounded-lg text-gray-600 dark:text-gray-300",children:e.jsx(ie,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm text-gray-900 dark:text-gray-100",children:he(u.method_id)}),u.reference&&e.jsxs("p",{className:"text-[10px] text-gray-500",children:["Ref: ",u.reference]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-sm",children:F(u.amount)}),e.jsx("button",{onClick:()=>O(m),className:"p-1 text-gray-400 hover:text-red-500 transition-colors",children:e.jsx(oe,{className:"w-4 h-4"})})]})]},m))})}),e.jsxs("div",{className:Y("p-3 rounded-xl text-center transition-colors",D?"bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-400":"bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400"),children:[e.jsx("p",{className:"text-xs font-bold uppercase tracking-wider opacity-80",children:D?n("pos.change_due","Change Due"):n("pos.remaining_balance","Remaining Balance")}),e.jsx("p",{className:"text-2xl font-bold mt-1 tracking-tight",children:F(D?X:I)})]}),e.jsxs(E.button,{whileTap:{scale:.98},onClick:J,disabled:!D&&h.length===0||j,className:Y("w-full py-3 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2 transition-all",D?"bg-green-600 hover:bg-green-700 text-white shadow-green-200 dark:shadow-none":"bg-blue-600 hover:bg-blue-700 text-white shadow-blue-200 dark:shadow-none",(h.length===0||j)&&"opacity-50 cursor-not-allowed shadow-none"),children:[j?e.jsx(G,{size:"sm",className:"text-white"}):e.jsx(xe,{className:"w-7 h-7"}),n("pos.complete_sale","Complete Sale")]})]})]})})}const de=288,De=80,$e=42;function Oe({saleId:t,onClose:x,autoPrint:p=!1,showQRCode:n=!0}){const{t:r,direction:a}=W(),c=s.useRef(null),{print:i,printerStatus:k,isPrinting:v,pendingCount:w}=Pe(),[g,L]=s.useState(null),[b,y]=s.useState(!0),[_,z]=s.useState(null),[C,j]=s.useState(null),o=s.useCallback(async()=>{y(!0),z(null);try{const h=await be.receipt(t);L(h)}catch{z(r("error.load_failed","Failed to load receipt"))}finally{y(!1)}},[t,r]);s.useEffect(()=>{o()},[o]),s.useEffect(()=>{p&&g&&!b&&l()},[p,g,b]);const l=async()=>{if(!g)return;j(null);const h=await i(g.html,g.invoice_number,a);j(h)},d=()=>{o()};return b?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(G,{})}):_?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-12 h-12 mx-auto mb-4 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-error-100)"},children:e.jsx("svg",{className:"w-6 h-6",style:{color:"var(--color-error-600)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("p",{className:"mb-4",style:{color:"var(--color-error-600)"},children:_}),e.jsx("button",{onClick:d,className:"btn btn-secondary btn-sm",children:r("common.retry","Retry")})]}):g?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[k.isOnline?e.jsx(Ne,{className:"w-4 h-4 text-green-500"}):e.jsx(pe,{className:"w-4 h-4 text-orange-500"}),e.jsx("span",{style:{color:k.isOnline?"var(--color-success-600)":"var(--color-warning-600)"},children:k.isOnline?r("pos.printer_ready","Printer Ready"):r("pos.printer_offline","Offline Mode")})]}),w>0&&e.jsxs("span",{className:"text-xs px-2 py-1 rounded-full bg-orange-100 text-orange-700",children:[w," ",r("pos.pending_prints","pending")]})]}),e.jsxs("div",{ref:c,className:"receipt-preview mx-auto rounded-lg shadow-inner overflow-auto",style:{backgroundColor:"var(--color-white)",border:"1px solid var(--color-gray-200)",width:`${de}px`,maxWidth:"100%",maxHeight:"400px",fontFamily:"'Courier New', 'Lucida Console', Monaco, monospace",fontSize:"12px",lineHeight:"1.3",padding:"8px"},children:[e.jsx("div",{dangerouslySetInnerHTML:{__html:g.html},style:{maxWidth:`${de-16}px`}}),n&&e.jsxs("div",{className:"receipt-qr text-center mt-4 pt-2 border-t border-dashed border-gray-300",children:[e.jsx(Ce,{className:"w-16 h-16 mx-auto text-gray-400"}),e.jsx("p",{className:"text-xs mt-1 text-gray-500",children:r("pos.scan_for_digital","Scan for digital receipt")})]})]}),C===!0&&e.jsxs("div",{className:"text-center text-sm text-green-600 flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),r("pos.print_sent","Print job sent")]}),C===!1&&e.jsxs("div",{className:"text-center text-sm text-orange-600 flex items-center justify-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4"}),r("pos.print_queued","Added to print queue")]}),e.jsxs("div",{className:"flex gap-3",children:[x&&e.jsx("button",{onClick:x,className:"btn btn-secondary flex-1 min-h-[48px]",children:r("common.close","Close")}),e.jsxs("button",{onClick:l,disabled:v,className:"btn btn-primary flex-1 min-h-[48px] flex items-center justify-center gap-2",children:[v?e.jsx(G,{size:"sm"}):e.jsx(Se,{className:"w-5 h-5"}),r("pos.print_receipt","Print Receipt")]})]}),e.jsxs("div",{className:"text-center space-y-1",children:[e.jsxs("div",{className:"text-sm font-medium",style:{color:"var(--color-gray-700)"},children:[r("pos.invoice","Invoice"),": ",g.invoice_number]}),e.jsxs("div",{className:"text-xs",style:{color:"var(--color-gray-400)"},children:[De,"mm Ã— ~",$e," ",r("pos.chars_per_line","chars/line")]})]})]}):null}function We({isOpen:t,onClose:x,saleId:p,onNewSale:n}){const{t:r}=W(),[a,c]=s.useState(!1),i=s.useMemo(()=>`${p}-${t}`,[p,t]),[k,v]=s.useState(i);i!==k&&(v(i),c(!1));const w=()=>{x(),n?.()};return p?e.jsx(Q,{isOpen:t,onClose:x,title:a?r("pos.receipt","Receipt"):r("pos.sale_complete","Sale Complete"),size:a?"md":"sm",children:a?e.jsx(Oe,{saleId:p,onClose:()=>c(!1)}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-success-100)"},children:e.jsx("svg",{className:"w-10 h-10",style:{color:"var(--color-success-600)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("h3",{className:"text-2xl font-bold mb-2",style:{color:"var(--color-gray-900)"},children:r("pos.thank_you","Thank You!")}),e.jsx("p",{className:"text-lg mb-6",style:{color:"var(--color-gray-600)"},children:r("pos.sale_complete_message","Sale has been completed successfully.")}),e.jsxs("div",{className:"inline-block px-4 py-2 rounded-lg mb-6",style:{backgroundColor:"var(--color-gray-100)"},children:[e.jsx("span",{className:"text-sm",style:{color:"var(--color-gray-500)"},children:r("pos.sale_id","Sale ID")}),e.jsxs("span",{className:"block text-xl font-mono font-bold",style:{color:"var(--color-primary-600)"},children:["#",p]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>c(!0),className:"btn btn-secondary flex-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),r("pos.view_receipt","View Receipt")]}),e.jsxs("button",{onClick:()=>{c(!0)},className:"btn btn-secondary flex-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),r("pos.print_receipt","Print Receipt")]})]}),e.jsxs("button",{onClick:w,className:"btn btn-primary w-full text-lg font-semibold",style:{minHeight:"48px"},children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),r("pos.new_sale","New Sale")]})]})]})}):null}function Je(){const{t,locale:x}=W(),{cart:p,addItem:n,clearCart:r,holdCart:a,recallCart:c,heldCarts:i,deleteHeldCart:k}=ne(),{isOnline:v,pendingCount:w}=ue(),g=s.useRef(null),L=s.useRef(null),[b,y]=s.useState(!1),[_,z]=s.useState(!1),[C,j]=s.useState(!1),[o,l]=s.useState(!1),[d,h]=s.useState(!1),[N,A]=s.useState(null),[B,H]=s.useState([]);s.useEffect(()=>{(async()=>{try{const S=await re.products();H(S)}catch(S){console.error("Failed to load products for barcode scanner:",S)}})()},[]);const T=s.useCallback(f=>{const S=B.find($=>$.barcode===f||$.sku===f);S?(n(S,1),p.items.find(O=>O.product.id===S.id)?M.success(t("pos.quantity_increased","Quantity increased")):M.success(t("pos.item_added","Item added to cart"))):M.error(t("pos.product_not_found","Product not found: ")+f)},[B,n,p.items,t]);He({onScan:T,enabled:!b&&!_&&!C&&!o&&!d,minLength:3});const U=f=>{n(f,1),M.success(t("pos.item_added","Item added to cart"))},V=s.useCallback(()=>{if(p.items.length===0){M.warning(t("pos.cart_empty","Cart is empty"));return}const f=t("pos.held_sale","Held Sale")+" #"+(i.length+1);a(f),M.info(t("pos.sale_held","Sale held for later"))},[p.items.length,i.length,a,t]),F=f=>{c(f.id),j(!1),M.info(t("pos.sale_recalled","Sale recalled"))},K=s.useCallback(()=>{if(i.length===0){M.info(t("pos.no_held_sales","No held sales"));return}j(!0)},[i.length,t]),I=()=>{z(!1),r(),M.info(t("pos.cart_cleared","Cart cleared"))},X=s.useCallback(()=>{if(p.items.length===0){M.warning(t("pos.cart_empty","Cart is empty"));return}y(!0)},[p.items.length,t]),D=async f=>{y(!1),A(f),l(!0);try{await L.current?.refreshProducts()}catch(S){console.error("Failed to refresh products after sale:",S)}},Z=s.useCallback(()=>{g.current?.focus()},[]);Re({onHelp:()=>h(!0),onSearch:Z,onHoldSale:V,onRecallSale:K,onCheckout:X});const ee=f=>new Intl.NumberFormat(x==="ar"?"ar-LY":"en-LY",{style:"currency",currency:"LYD",minimumFractionDigits:3}).format(f),te=[{key:"F1",action:t("pos.shortcuts.help","Show shortcuts help")},{key:"F2",action:t("pos.shortcuts.search","Focus search")},{key:"F5",action:t("pos.shortcuts.hold","Hold current sale")},{key:"F6",action:t("pos.shortcuts.recall","Recall held sale")},{key:"F12",action:t("pos.shortcuts.checkout","Proceed to checkout")},{key:"Esc",action:t("pos.shortcuts.close","Close modal")}];return e.jsxs("div",{className:"flex flex-col",style:{height:"calc(100vh - var(--header-height))",margin:"-1.5rem",backgroundColor:"var(--color-gray-100)"},children:[(!v||w>0)&&e.jsx(ye,{variant:"banner",className:"flex-shrink-0"}),e.jsxs("div",{className:"flex flex-col lg:flex-row flex-1 overflow-hidden",children:[e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(ke,{ref:L,onProductSelect:U})}),e.jsx("div",{className:"w-full lg:w-[450px] xl:w-[500px] flex-shrink-0 shadow-lg bg-white dark:bg-zinc-900 flex flex-col max-h-[50vh] lg:max-h-none lg:h-full transition-all duration-300",children:e.jsx("div",{className:"h-full flex flex-col",children:e.jsx(Fe,{onCheckout:X,onHold:V,onClear:()=>z(!0),onRecall:K,hasHeldSales:i.length>0})})}),e.jsxs(Q,{isOpen:d,onClose:()=>h(!1),title:t("pos.keyboard_shortcuts","Keyboard Shortcuts"),size:"sm",children:[e.jsx("div",{className:"space-y-2",children:te.map(({key:f,action:S})=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b last:border-0",style:{borderColor:"var(--color-gray-100)"},children:[e.jsx("span",{style:{color:"var(--color-gray-700)"},children:S}),e.jsx("kbd",{className:"px-2 py-1 text-xs font-mono rounded",style:{backgroundColor:"var(--color-gray-100)",color:"var(--color-gray-900)",border:"1px solid var(--color-gray-300)"},children:f})]},f))}),e.jsx("p",{className:"mt-4 text-sm text-center",style:{color:"var(--color-gray-500)"},children:t("pos.press_f1_help","Press F1 anytime to show this help")})]}),e.jsx(Ie,{isOpen:b,onClose:()=>y(!1),onSuccess:D}),_&&e.jsxs(Q,{isOpen:_,onClose:()=>z(!1),title:t("pos.clear_cart","Clear Cart"),size:"sm",children:[e.jsx("div",{className:"py-4",children:e.jsx("p",{style:{color:"var(--color-gray-600)"},children:t("pos.clear_cart_confirm","Are you sure you want to remove all items from the cart?")})}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:()=>z(!1),className:"btn btn-secondary flex-1",children:t("common.cancel","Cancel")}),e.jsx("button",{onClick:I,className:"btn btn-danger flex-1",children:t("pos.clear","Clear")})]})]}),e.jsx(Q,{isOpen:C,onClose:()=>j(!1),title:t("pos.held_sales","Held Sales"),size:"md",children:i.length===0?e.jsx("div",{className:"py-8 text-center",style:{color:"var(--color-gray-500)"},children:t("pos.no_held_sales","No held sales")}):e.jsx("div",{className:"space-y-3",children:i.map(f=>{const S=f.cart.items.reduce((O,J)=>O+J.unit_price*J.quantity,0),$=f.cart.discount?S*(1-f.cart.discount/100):S;return e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border cursor-pointer hover:bg-gray-50",style:{borderColor:"var(--color-gray-200)"},onClick:()=>F(f),children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",style:{color:"var(--color-gray-900)"},children:[f.name," - ",f.cart.items.length," ",t("pos.items","items"),f.cart.customer&&` - ${f.cart.customer.name}`]}),e.jsx("div",{className:"text-sm",style:{color:"var(--color-gray-500)"},children:f.held_at.toLocaleString()})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-semibold",style:{color:"var(--color-primary-600)"},children:ee($)}),e.jsx("button",{onClick:O=>{O.stopPropagation(),k(f.id)},className:"p-2 rounded hover:bg-red-50",style:{color:"var(--color-error-500)"},children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},f.id)})})}),e.jsx(We,{isOpen:o,onClose:()=>l(!1),saleId:N})]})]})}export{Je as POSPage,Je as default};
