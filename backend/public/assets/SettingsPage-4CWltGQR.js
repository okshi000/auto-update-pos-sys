import{e as P,j as e,C as z,c as w,y as R,z as B,B as h,A as O,D as j,E as U,a as X,g as q,F as E,t as o,L as T,G as F}from"./index-Nde1j7Yg.js";import{r as d,c as _}from"./vendor-react-DsCSLZ3L.js";import{F as c}from"./FormField-DuaIuRcX.js";import{F as H}from"./FormError-D4zmGTMi.js";import{H as I,m as $,C as G,n as W,R as S,o as J,c as K,T as Q,j as M,p as L}from"./vendor-icons-Doz15FS9.js";import"./vendor-utils-DMdnf9MG.js";import"./vendor-charts-DGg1Za7c.js";const V=({className:a})=>{const{isOnline:i,isSyncing:x,pendingCount:n,isCatalogReady:l,isLoadingCatalog:g,lastCatalogSync:f,syncCatalog:v,syncPendingSales:N,clearOfflineData:b,getPendingSales:u}=P(),[p,y]=d.useState([]),[C,t]=d.useState(!1),r=_.useRef(n),m=_.useCallback(async()=>{const s=await u();y(s)},[u]);_.useEffect(()=>{m()},[]),_.useEffect(()=>{r.current!==n&&(r.current=n,m())},[n,m]);const k=async()=>{try{await v()}catch(s){console.error("Failed to sync catalog:",s)}},D=async()=>{const s=await N();s.synced>0&&console.log(`Synced ${s.synced} sales, ${s.failed} failed`)},Y=async()=>{await b(),y([]),t(!1)},A=s=>{switch(s){case"pending":return e.jsx(h,{variant:"warning",children:"Pending"});case"syncing":return e.jsx(h,{variant:"info",children:"Syncing"});case"synced":return e.jsx(h,{variant:"success",children:"Synced"});case"failed":return e.jsx(h,{variant:"danger",children:"Failed"});default:return e.jsx(h,{children:s})}};return e.jsxs(z,{className:w("",a),children:[e.jsx(R,{children:e.jsxs(B,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5"}),"Offline Storage & Sync"]}),e.jsx(h,{variant:i?"success":"danger",children:i?"Online":"Offline"})]})}),e.jsxs(O,{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[i?e.jsx($,{className:"h-5 w-5 text-green-600"}):e.jsx(G,{className:"h-5 w-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:i?"Connected to server":"No connection"}),e.jsx("p",{className:"text-sm text-gray-500",children:i?"Sales will sync automatically":"Sales will be saved locally"})]})]})}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{className:w("h-5 w-5",l?"text-green-600":"text-yellow-600")}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Product Catalog"}),e.jsx("p",{className:"text-sm text-gray-500",children:l?`Cached ${f?Z(f):""}`:"Not cached - offline mode limited"})]})]}),e.jsxs(j,{size:"sm",variant:"outline",onClick:k,disabled:!i||g,children:[e.jsx(S,{className:w("h-4 w-4 mr-1",g&&"animate-spin")}),g?"Syncing...":"Sync"]})]}),e.jsxs("div",{className:"border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:"Pending Sales"}),n>0&&e.jsx(h,{variant:"warning",children:n})]}),n>0&&e.jsxs(j,{size:"sm",onClick:D,disabled:!i||x,children:[e.jsx(S,{className:w("h-4 w-4 mr-1",x&&"animate-spin")}),x?"Syncing...":"Sync All"]})]}),p.length===0?e.jsxs("div",{className:"p-4 text-center text-gray-500",children:[e.jsx(K,{className:"h-8 w-8 mx-auto mb-2 text-green-500"}),e.jsx("p",{children:"No pending sales"})]}):e.jsx("div",{className:"max-h-60 overflow-y-auto",children:p.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border-b last:border-b-0 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm font-medium",children:[s.items.length," item",s.items.length!==1?"s":""," •"," ","$",s.total.toFixed(2)]}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(s.created_at).toLocaleString()}),s.error_message&&e.jsxs("p",{className:"text-xs text-red-500 mt-1",children:[e.jsx(Q,{className:"h-3 w-3 inline mr-1"}),s.error_message]})]}),A(s.status)]},s.id))})]})]}),e.jsx(U,{className:"border-t pt-4",children:C?e.jsxs("div",{className:"flex items-center justify-between w-full gap-2",children:[e.jsx("span",{className:"text-sm text-red-600",children:"This will delete all cached data and pending sales!"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{size:"sm",variant:"outline",onClick:()=>t(!1),children:"Cancel"}),e.jsx(j,{size:"sm",variant:"destructive",onClick:Y,children:"Confirm Delete"})]})]}):e.jsxs(j,{variant:"outline",size:"sm",className:"text-red-600 hover:bg-red-50",onClick:()=>t(!0),children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),"Clear All Offline Data"]})})]})};function Z(a){return a.toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function ne(){const{t:a,locale:i,setLocale:x}=X(),{hasPermission:n}=q(),l=n("settings.edit"),g=n("system.manage"),[f,v]=d.useState(!0),[N,b]=d.useState(!1),[u,p]=d.useState(!1),[y,C]=d.useState(null),[t,r]=d.useState({}),m=d.useCallback(async()=>{v(!0);try{const s=await E.get();r(s)}catch{o.error(a("error.load_failed","Failed to load settings"))}finally{v(!1)}},[a]),k=async()=>{b(!0),C(null);try{await E.update(t),o.success(a("settings.saved","Settings saved successfully")),m()}catch(s){C(s instanceof Error?s.message:a("error.save_failed","Failed to save"))}finally{b(!1)}},D=async()=>{if(confirm(a("system.update_confirm","Are you sure you want to update the system? The application will restart automatically."))){p(!0);try{const s=await F.update();o.success(s.message),setTimeout(()=>{o.info(a("system.restarting","System is restarting... Please wait 30-60 seconds."))},2e3)}catch(s){o.error(s instanceof Error?s.message:a("system.update_failed","Update failed")),p(!1)}}},Y=async()=>{try{const s=await F.clearCache();o.success(s.message)}catch(s){o.error(s instanceof Error?s.message:a("system.clear_cache_failed","Failed to clear cache"))}},A=async()=>{try{const s=await F.backup();o.success(s.message)}catch(s){o.error(s instanceof Error?s.message:a("system.backup_failed","Backup failed"))}};return d.useEffect(()=>{m()},[m]),f?e.jsx("div",{className:"py-12",children:e.jsx(T,{fullPage:!0})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:e.jsx("h1",{className:"text-2xl font-semibold",style:{color:"var(--color-gray-900)"},children:a("nav.settings","Settings")})}),y&&e.jsx("div",{className:"card",children:e.jsx(H,{message:y})}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",style:{color:"var(--color-gray-900)"},children:a("settings.general","General Settings")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(c,{label:a("settings.company_name","Company Name"),children:e.jsx("input",{type:"text",value:t.company_name||"",onChange:s=>r({...t,company_name:s.target.value}),className:"input",disabled:!l,placeholder:a("settings.company_placeholder","Your Company Name")})}),e.jsx(c,{label:a("settings.phone","Phone Number"),children:e.jsx("input",{type:"tel",value:t.phone||"",onChange:s=>r({...t,phone:s.target.value}),className:"input",disabled:!l,placeholder:"+218 XX XXX XXXX"})}),e.jsx(c,{label:a("settings.email","Email"),children:e.jsx("input",{type:"email",value:t.email||"",onChange:s=>r({...t,email:s.target.value}),className:"input",disabled:!l,placeholder:"contact@company.com"})}),e.jsx(c,{label:a("settings.address","Address"),children:e.jsx("input",{type:"text",value:t.address||"",onChange:s=>r({...t,address:s.target.value}),className:"input",disabled:!l,placeholder:a("settings.address_placeholder","Business address")})})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",style:{color:"var(--color-gray-900)"},children:a("settings.regional","Regional Settings")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(c,{label:a("settings.language","Language"),children:e.jsxs("select",{value:i,onChange:s=>x(s.target.value),className:"input",children:[e.jsx("option",{value:"en",children:"English"}),e.jsx("option",{value:"ar",children:"العربية"})]})}),e.jsx(c,{label:a("settings.currency","Currency"),children:e.jsx("input",{type:"text",value:t.currency||"LYD",onChange:s=>r({...t,currency:s.target.value}),className:"input",disabled:!l})}),e.jsx(c,{label:a("settings.timezone","Timezone"),children:e.jsxs("select",{value:t.timezone||"Africa/Tripoli",onChange:s=>r({...t,timezone:s.target.value}),className:"input",disabled:!l,children:[e.jsx("option",{value:"Africa/Tripoli",children:"Africa/Tripoli (Libya)"}),e.jsx("option",{value:"UTC",children:"UTC"}),e.jsx("option",{value:"Africa/Cairo",children:"Africa/Cairo (Egypt)"}),e.jsx("option",{value:"Africa/Tunis",children:"Africa/Tunis (Tunisia)"})]})}),e.jsx(c,{label:a("settings.date_format","Date Format"),children:e.jsxs("select",{value:t.date_format||"DD/MM/YYYY",onChange:s=>r({...t,date_format:s.target.value}),className:"input",disabled:!l,children:[e.jsx("option",{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),e.jsx("option",{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),e.jsx("option",{value:"YYYY-MM-DD",children:"YYYY-MM-DD"})]})})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",style:{color:"var(--color-gray-900)"},children:a("settings.pos","POS Settings")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(c,{label:a("settings.receipt_header","Receipt Header"),children:e.jsx("textarea",{value:t.receipt_header||"",onChange:s=>r({...t,receipt_header:s.target.value}),className:"input",rows:3,disabled:!l,placeholder:a("settings.receipt_header_placeholder","Text shown at top of receipts")})}),e.jsx(c,{label:a("settings.receipt_footer","Receipt Footer"),children:e.jsx("textarea",{value:t.receipt_footer||"",onChange:s=>r({...t,receipt_footer:s.target.value}),className:"input",rows:3,disabled:!l,placeholder:a("settings.receipt_footer_placeholder","Text shown at bottom of receipts")})}),e.jsx(c,{label:a("settings.low_stock_threshold","Low Stock Threshold"),children:e.jsx("input",{type:"number",min:"0",value:t.low_stock_threshold||10,onChange:s=>r({...t,low_stock_threshold:parseInt(s.target.value)||10}),className:"input",disabled:!l})})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.allow_negative_stock||!1,onChange:s=>r({...t,allow_negative_stock:s.target.checked}),className:"w-5 h-5 rounded",style:{accentColor:"var(--color-primary-600)"},disabled:!l}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",style:{color:"var(--color-gray-900)"},children:a("settings.allow_negative","Allow Negative Stock")}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-gray-500)"},children:a("settings.allow_negative_desc","Allow sales even when stock is zero or below")})]})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.require_customer||!1,onChange:s=>r({...t,require_customer:s.target.checked}),className:"w-5 h-5 rounded",style:{accentColor:"var(--color-primary-600)"},disabled:!l}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",style:{color:"var(--color-gray-900)"},children:a("settings.require_customer","Require Customer Selection")}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-gray-500)"},children:a("settings.require_customer_desc","Require a customer to be selected before checkout")})]})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.print_receipt_auto||!1,onChange:s=>r({...t,print_receipt_auto:s.target.checked}),className:"w-5 h-5 rounded",style:{accentColor:"var(--color-primary-600)"},disabled:!l}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",style:{color:"var(--color-gray-900)"},children:a("settings.auto_print","Auto-Print Receipts")}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-gray-500)"},children:a("settings.auto_print_desc","Automatically print receipt after each sale")})]})]})]})]}),e.jsx(V,{}),g&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",style:{color:"var(--color-gray-900)"},children:a("system.management","System Management")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between p-4 rounded-lg",style:{backgroundColor:"var(--color-gray-50)"},children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(S,{className:"w-5 h-5",style:{color:"var(--color-primary-600)"}}),e.jsx("span",{className:"font-medium",style:{color:"var(--color-gray-900)"},children:a("system.update","System Update")})]}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-gray-500)"},children:a("system.update_desc","Update the system to the latest version from GitHub")})]}),e.jsx("button",{onClick:D,disabled:u,className:"btn btn-primary",children:u?e.jsx(T,{size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-4 h-4"}),a("system.update_now","Update Now")]})})]}),e.jsxs("div",{className:"flex items-start justify-between p-4 rounded-lg",style:{backgroundColor:"var(--color-gray-50)"},children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(M,{className:"w-5 h-5",style:{color:"var(--color-orange-600)"}}),e.jsx("span",{className:"font-medium",style:{color:"var(--color-gray-900)"},children:a("system.clear_cache","Clear Cache")})]}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-gray-500)"},children:a("system.clear_cache_desc","Clear application cache and compiled views")})]}),e.jsxs("button",{onClick:Y,className:"btn btn-secondary",children:[e.jsx(M,{className:"w-4 h-4"}),a("system.clear","Clear")]})]}),e.jsxs("div",{className:"flex items-start justify-between p-4 rounded-lg",style:{backgroundColor:"var(--color-gray-50)"},children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(L,{className:"w-5 h-5",style:{color:"var(--color-green-600)"}}),e.jsx("span",{className:"font-medium",style:{color:"var(--color-gray-900)"},children:a("system.backup","Database Backup")})]}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-gray-500)"},children:a("system.backup_desc","Create a backup of the database")})]}),e.jsxs("button",{onClick:A,className:"btn btn-secondary",children:[e.jsx(L,{className:"w-4 h-4"}),a("system.backup_now","Backup")]})]})]})]}),l&&e.jsx("div",{className:"card",children:e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:k,disabled:N,className:"btn btn-primary",children:N?e.jsx(T,{size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),a("settings.save","Save Settings")]})})})})]})}export{ne as SettingsPage,ne as default};
