import{a as M,J as Y,j as e,m as Q,f as ee,g as E,t as N,L as ve,h as A,B as be,S as ye}from"./index-DY0r9i56.js";import{r as s,b as je}from"./vendor-react-DsCSLZ3L.js";import{C as te}from"./ConfirmDialog-D7BXuKwQ.js";import{E as ke,D as Ce}from"./DataTable-SCbMgeDn.js";import{S as T}from"./Select-C4DkMOpv.js";import{A as we,M as q}from"./Modal-CHr8xayP.js";import{C as G}from"./CurrencyInput-CURGi8oT.js";import{F as S}from"./FormField-UcBTSXLd.js";import{F as re}from"./FormError-CQ50cYNP.js";import{F as se}from"./FormActions-BbxD6i3h.js";import"./vendor-utils-DMdnf9MG.js";import"./vendor-charts-DGg1Za7c.js";import"./vendor-icons-DU-kWQ55.js";function X(t){return/^\d{13}$/.test(t)?"EAN13":/^\d{8}$/.test(t)?"EAN8":"CODE128"}function ae({isOpen:t,onClose:v,product:o}){const{t:a,direction:p}=M(),[g,i]=s.useState(1),[y,w]=s.useState(!1),[m,_]=s.useState(!0),f=s.useRef([]),n=s.useRef(null);s.useEffect(()=>{if(t&&o?.barcode){const h=setTimeout(()=>{d()},100);return()=>clearTimeout(h)}},[t,o?.barcode,g]);const d=s.useCallback(()=>{if(!o?.barcode)return;const h=X(o.barcode);f.current.forEach(c=>{if(c)try{Y(c,o.barcode,{format:h,width:2,height:50,displayValue:!0,fontSize:12,margin:5,background:"#ffffff",lineColor:"#000000"})}catch(j){console.error("Barcode generation error:",j);try{Y(c,o.barcode,{format:"CODE128",width:2,height:50,displayValue:!0,fontSize:12,margin:5,background:"#ffffff",lineColor:"#000000"})}catch(C){console.error("Fallback barcode generation error:",C)}}})},[o?.barcode]),x=h=>new Intl.NumberFormat("en-LY",{minimumFractionDigits:3,maximumFractionDigits:3}).format(h)+" "+a("currency.lyd","LYD"),k=s.useCallback(()=>{if(!o?.barcode)return;w(!0);const h=`
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="UTF-8">
        <title>Print Barcode - ${o.name}</title>
        <style>
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          
          @page {
            size: 50mm 30mm;
            margin: 0;
          }
          
          body {
            font-family: Arial, sans-serif;
            background: white;
          }
          
          .sticker-container {
            display: flex;
            flex-wrap: wrap;
            gap: 2mm;
            padding: 2mm;
          }
          
          .sticker {
            width: 48mm;
            min-height: 28mm;
            padding: 2mm;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            page-break-inside: avoid;
            break-inside: avoid;
          }
          
          .product-name {
            font-size: 9pt;
            font-weight: bold;
            text-align: center;
            margin-bottom: 2mm;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
          }
          
          .barcode-svg {
            max-width: 44mm;
            height: auto;
          }
          
          .product-price {
            font-size: 8pt;
            margin-top: 1mm;
            color: #333;
          }
          
          @media print {
            body {
              -webkit-print-color-adjust: exact;
              print-color-adjust: exact;
            }
            
            .sticker {
              page-break-inside: avoid;
              break-inside: avoid;
            }
          }
        </style>
      </head>
      <body>
        <div class="sticker-container">
          ${Array(g).fill(null).map(()=>`
            <div class="sticker">
              <div class="product-name">${u(o.name)}</div>
              <svg class="barcode-svg" id="barcode-print"></svg>
              ${m?`<div class="product-price">${x(o.price)}</div>`:""}
            </div>
          `).join("")}
        </div>
        <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"><\/script>
        <script>
          document.querySelectorAll('.barcode-svg').forEach(function(svg) {
            try {
              JsBarcode(svg, "${b(o.barcode)}", {
                format: "${X(o.barcode)}",
                width: 2,
                height: 50,
                displayValue: true,
                fontSize: 12,
                margin: 5,
                background: '#ffffff',
                lineColor: '#000000'
              });
            } catch(e) {
              JsBarcode(svg, "${b(o.barcode)}", {
                format: "CODE128",
                width: 2,
                height: 50,
                displayValue: true,
                fontSize: 12,
                margin: 5,
                background: '#ffffff',
                lineColor: '#000000'
              });
            }
          });
          
          setTimeout(function() {
            window.print();
            setTimeout(function() {
              window.close();
            }, 500);
          }, 300);
        <\/script>
      </body>
      </html>
    `,c=window.open("","_blank","width=400,height=600");if(c)c.document.write(h),c.document.close();else{const j=document.createElement("iframe");j.style.position="fixed",j.style.right="0",j.style.bottom="0",j.style.width="0",j.style.height="0",j.style.border="none",document.body.appendChild(j);const C=j.contentWindow?.document;C&&(C.open(),C.write(h),C.close(),setTimeout(()=>{document.body.removeChild(j)},2e3))}w(!1),v()},[o,g,m,x,v,a]);function u(h){const c=document.createElement("div");return c.textContent=h,c.innerHTML}function b(h){return h.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/'/g,"\\'")}return o?je.createPortal(e.jsx(we,{children:t&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":"barcode-modal-title",dir:p,children:[e.jsx(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:v}),e.jsxs(Q.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{duration:.2},className:"relative w-full max-w-md bg-white rounded-2xl shadow-xl overflow-hidden",style:{backgroundColor:"var(--color-bg-base)"},children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",style:{borderColor:"var(--color-border-subtle)"},children:[e.jsx("h2",{id:"barcode-modal-title",className:"text-lg font-semibold",style:{color:"var(--color-gray-900)"},children:a("products.print_barcode","Print Barcode")}),e.jsx("button",{onClick:v,className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",style:{minHeight:"48px",minWidth:"48px"},"aria-label":a("common.close","Close"),children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"font-medium text-lg",style:{color:"var(--color-gray-900)"},children:o.name}),e.jsxs("p",{className:"text-sm mt-1",style:{color:"var(--color-gray-500)"},children:[a("products.barcode","Barcode"),": ",o.barcode]})]}),e.jsxs("div",{className:"p-4 rounded-lg border-2 border-dashed flex flex-col items-center",style:{borderColor:"var(--color-border-default)",backgroundColor:"var(--color-bg-subtle)"},children:[e.jsx("p",{className:"text-xs mb-2",style:{color:"var(--color-gray-500)"},children:a("products.barcode_preview","Preview")}),e.jsxs("div",{className:"bg-white p-3 rounded shadow-sm",children:[e.jsx("svg",{ref:h=>{f.current[0]=h},className:"barcode-preview"}),e.jsx("p",{className:"text-center text-sm font-medium mt-2",children:o.name}),m&&e.jsx("p",{className:"text-center text-xs mt-1",style:{color:"var(--color-gray-600)"},children:x(o.price)})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"font-medium",style:{color:"var(--color-gray-700)"},children:a("products.quantity","Quantity")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>i(Math.max(1,g-1)),className:"w-10 h-10 rounded-lg border flex items-center justify-center hover:bg-gray-50 transition-colors",style:{borderColor:"var(--color-border-default)",minHeight:"48px",minWidth:"48px"},disabled:g<=1,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),e.jsx("input",{type:"number",min:"1",max:"100",value:g,onChange:h=>i(Math.max(1,Math.min(100,parseInt(h.target.value)||1))),className:"w-16 h-12 text-center border rounded-lg font-medium",style:{borderColor:"var(--color-border-default)"}}),e.jsx("button",{onClick:()=>i(Math.min(100,g+1)),className:"w-10 h-10 rounded-lg border flex items-center justify-center hover:bg-gray-50 transition-colors",style:{borderColor:"var(--color-border-default)",minHeight:"48px",minWidth:"48px"},disabled:g>=100,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"font-medium",style:{color:"var(--color-gray-700)"},children:a("products.show_price","Show Price")}),e.jsx("button",{onClick:()=>_(!m),className:`relative w-12 h-7 rounded-full transition-colors ${m?"bg-primary-600":"bg-gray-300"}`,style:{backgroundColor:m?"var(--color-primary-600)":"var(--color-gray-300)",minHeight:"48px",minWidth:"48px",padding:"10px"},role:"switch","aria-checked":m,children:e.jsx("span",{className:`absolute top-1 w-5 h-5 bg-white rounded-full shadow transition-transform ${m?"translate-x-5":"translate-x-0"}`,style:{top:"14px",left:m?"auto":"14px",right:m?"14px":"auto"}})})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 px-6 py-4 border-t",style:{borderColor:"var(--color-border-subtle)",backgroundColor:"var(--color-bg-subtle)"},children:[e.jsx("button",{onClick:v,className:"btn btn-secondary px-6",style:{minHeight:"48px"},children:a("common.cancel","Cancel")}),e.jsx("button",{onClick:k,disabled:y||!o.barcode,className:"btn btn-primary px-6 flex items-center gap-2",style:{minHeight:"48px"},children:y?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),a("common.printing","Printing...")]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),a("products.print","Print")," (",g,")"]})})]})]}),e.jsx("iframe",{ref:n,style:{display:"none"},title:"Print Frame"})]})}),document.body):null}function Z(t){return t?{sku:t.sku||"",barcode:t.barcode||"",name:t.name,description:t.description||"",category_id:t.category_id,cost_price:t.cost_price,price:t.price,min_stock_level:t.min_stock_level,is_active:t.is_active}:{sku:"",barcode:"",name:"",description:"",category_id:null,cost_price:0,price:0,min_stock_level:0,is_active:!0}}function Ne({isOpen:t,onClose:v,onSubmit:o,product:a,categories:p,isLoading:g=!1}){const{t:i}=M(),{hasPermission:y}=ee(),w=!!a,m=y("products.print"),_=s.useMemo(()=>Z(a),[a]),f=s.useMemo(()=>`${a?.id??"new"}-${t}`,[a?.id,t]),[n,d]=s.useState(_),[x,k]=s.useState({}),[u,b]=s.useState(null),[h,c]=s.useState(f),[j,C]=s.useState(!1);f!==h&&(c(f),d(Z(a)),k({}),b(null));const I=()=>{!a?.barcode||!a?.id||C(!0)},L=()=>{const l={};return n.name.trim()||(l.name=i("validation.required","This field is required")),n.price<=0&&(l.price=i("validation.positive","Must be greater than 0")),n.cost_price<0&&(l.cost_price=i("validation.non_negative","Cannot be negative")),k(l),Object.keys(l).length===0},B=async l=>{if(l.preventDefault(),b(null),!!L())try{await o(n),v()}catch(F){b(F instanceof Error?F.message:i("error.save_failed","Failed to save"))}},z=[{value:"",label:i("common.none","(None)")},...p.map(l=>({value:l.id,label:l.name}))];return e.jsxs(q,{isOpen:t,onClose:v,title:w?i("products.edit","Edit Product"):i("products.create","Add Product"),size:"lg",children:[e.jsxs("form",{onSubmit:B,children:[u&&e.jsx(re,{message:u}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(S,{label:i("products.sku","SKU"),htmlFor:"sku",children:e.jsx("input",{id:"sku",type:"text",value:n.sku||"",onChange:l=>d({...n,sku:l.target.value||null}),className:"input",placeholder:"PRD-001"})}),e.jsx(S,{label:i("products.barcode","Barcode"),htmlFor:"barcode",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{id:"barcode",type:"text",value:n.barcode||"",onChange:l=>d({...n,barcode:l.target.value||null}),className:"input flex-1",placeholder:"123456789012"}),w&&m&&a?.barcode&&e.jsx("button",{type:"button",onClick:I,disabled:!n.barcode,className:"btn btn-secondary",style:{minHeight:"48px",minWidth:"48px"},title:i("products.print_barcode","Print Barcode"),children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})})})]})})]}),e.jsx(S,{label:i("products.name","Name"),htmlFor:"name",required:!0,error:x.name,children:e.jsx("input",{id:"name",type:"text",value:n.name,onChange:l=>d({...n,name:l.target.value}),className:`input ${x.name?"input-error":""}`})}),e.jsx(S,{label:i("products.description","Description"),htmlFor:"description",children:e.jsx("textarea",{id:"description",value:n.description||"",onChange:l=>d({...n,description:l.target.value||null}),className:"input",rows:3})}),e.jsx(S,{label:i("products.category","Category"),htmlFor:"category",children:e.jsx(T,{value:n.category_id??null,onChange:l=>d({...n,category_id:l}),options:z,clearable:!0,searchable:!0})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(S,{label:i("products.cost_price","Cost Price"),error:x.cost_price,children:e.jsx(G,{value:n.cost_price,onChange:l=>d({...n,cost_price:l||0}),error:x.cost_price})}),e.jsx(S,{label:i("products.price","Price"),required:!0,error:x.price,children:e.jsx(G,{value:n.price,onChange:l=>d({...n,price:l||0}),error:x.price})}),e.jsx(S,{label:i("products.min_stock","Min Stock Level"),children:e.jsx("input",{type:"number",min:"0",value:n.min_stock_level,onChange:l=>d({...n,min_stock_level:parseInt(l.target.value)||0}),className:"input"})})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("input",{id:"is_active",type:"checkbox",checked:n.is_active,onChange:l=>d({...n,is_active:l.target.checked}),className:"w-4 h-4 rounded",style:{accentColor:"var(--color-primary-600)"}}),e.jsx("label",{htmlFor:"is_active",style:{color:"var(--color-gray-700)"},children:i("products.is_active","Product is active")})]}),e.jsx(se,{onCancel:v,isSubmitting:g,submitLabel:w?i("common.update","Update"):i("common.create","Create")})]}),a&&e.jsx(ae,{isOpen:j,onClose:()=>C(!1),product:a})]})}function _e({isOpen:t,onClose:v,onCategoriesChange:o}){const{t:a}=M(),[p,g]=s.useState([]),[i,y]=s.useState(!1),[w,m]=s.useState(null),[_,f]=s.useState(!1),[n,d]=s.useState(null),[x,k]=s.useState(!1),u=s.useCallback(async()=>{y(!0);try{const c=await E.list();g(c)}catch{N.error(a("error.load_failed","Failed to load data"))}finally{y(!1)}},[a]);s.useEffect(()=>{t&&u()},[t,u]);const b=c=>{m(c),f(!0)},h=async()=>{if(n){k(!0);try{await E.delete(n),N.success(a("categories.deleted","Category deleted")),d(null),u(),o()}catch{N.error(a("error.delete_failed","Failed to delete"))}finally{k(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsxs(q,{isOpen:t,onClose:v,title:a("categories.manage","Manage Categories"),size:"lg",children:[e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:()=>{m(null),f(!0)},className:"btn btn-primary",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),a("categories.add","Add Category")]})}),i?e.jsx("div",{className:"py-8",children:e.jsx(ve,{})}):p.length===0?e.jsx(ke,{icon:"ðŸ“",title:a("categories.empty","No categories yet"),description:a("categories.empty_desc","Create your first category to organize products")}):e.jsx("div",{className:"space-y-2",children:p.map(c=>e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border",style:{borderColor:"var(--color-gray-200)"},children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",style:{color:"var(--color-gray-900)"},children:c.name}),c.description&&e.jsx("p",{className:"text-sm",style:{color:"var(--color-gray-500)"},children:c.description}),c.products_count!==void 0&&e.jsxs("span",{className:"text-sm",style:{color:"var(--color-gray-400)"},children:[c.products_count," ",a("common.products","products")]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>b(c),className:"btn btn-ghost p-2",title:a("common.edit","Edit"),children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>d(c.id),className:"btn btn-ghost p-2",style:{color:"var(--color-error-600)"},title:a("common.delete","Delete"),disabled:(c.products_count??0)>0,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},c.id))})]}),e.jsx(Se,{isOpen:_,onClose:()=>{f(!1),m(null)},category:w,onSave:()=>{f(!1),m(null),u(),o()}}),e.jsx(te,{isOpen:n!==null,onClose:()=>d(null),onConfirm:h,title:a("categories.delete_title","Delete Category"),message:a("categories.delete_confirm","Are you sure you want to delete this category?"),confirmText:a("common.delete","Delete"),isLoading:x})]})}function Se({isOpen:t,onClose:v,category:o,onSave:a}){const{t:p}=M(),g=!!o,[i,y]=s.useState({name:"",description:"",is_active:!0}),[w,m]=s.useState({}),[_,f]=s.useState(null),[n,d]=s.useState(!1);s.useEffect(()=>{y(o?{name:o.name,description:o.description||"",is_active:o.is_active}:{name:"",description:"",is_active:!0}),m({}),f(null)},[o,t]);const x=()=>{const u={};return i.name.trim()||(u.name=p("validation.required","This field is required")),m(u),Object.keys(u).length===0},k=async u=>{if(u.preventDefault(),!!x()){d(!0),f(null);try{g&&o?(await E.update(o.id,i),N.success(p("categories.updated","Category updated"))):(await E.create(i),N.success(p("categories.created","Category created"))),a()}catch(b){f(b instanceof Error?b.message:p("error.save_failed","Failed to save"))}finally{d(!1)}}};return e.jsx(q,{isOpen:t,onClose:v,title:g?p("categories.edit","Edit Category"):p("categories.add","Add Category"),size:"md",children:e.jsxs("form",{onSubmit:k,children:[_&&e.jsx(re,{message:_}),e.jsx(S,{label:p("categories.name","Name"),htmlFor:"cat-name",required:!0,error:w.name,children:e.jsx("input",{id:"cat-name",type:"text",value:i.name,onChange:u=>y({...i,name:u.target.value}),className:`input ${w.name?"input-error":""}`})}),e.jsx(S,{label:p("categories.description","Description"),htmlFor:"cat-description",children:e.jsx("textarea",{id:"cat-description",value:i.description||"",onChange:u=>y({...i,description:u.target.value||null}),className:"input",rows:3})}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("input",{id:"cat-is_active",type:"checkbox",checked:i.is_active,onChange:u=>y({...i,is_active:u.target.checked}),className:"w-4 h-4 rounded",style:{accentColor:"var(--color-primary-600)"}}),e.jsx("label",{htmlFor:"cat-is_active",style:{color:"var(--color-gray-700)"},children:p("categories.is_active","Category is active")})]}),e.jsx(se,{onCancel:v,isSubmitting:n,submitLabel:g?p("common.update","Update"):p("common.create","Create")})]})})}function $e(){const{t,locale:v}=M(),{hasPermission:o}=ee(),a=o("products.create"),p=o("products.update"),g=o("products.delete"),i=o("products.print"),[y,w]=s.useState([]),[m,_]=s.useState([]),[f,n]=s.useState(!0),[d,x]=s.useState({currentPage:1,totalPages:1,totalItems:0,perPage:15}),[k,u]=s.useState(""),[b,h]=s.useState(null),[c,j]=s.useState("all"),[C,I]=s.useState("name"),[L,B]=s.useState("asc"),[z,l]=s.useState(!1),[F,D]=s.useState(null),[W,O]=s.useState(null),[oe,V]=s.useState(!1),[ie,K]=s.useState(!1),[ne,J]=s.useState(!1),[R,U]=s.useState(null),H=s.useCallback(async()=>{n(!0);try{const r={page:d.currentPage,per_page:d.perPage,search:k||void 0,category_id:b,is_active:c==="all"?void 0:c==="active",sort_by:C,sort_direction:L},P=await A.list(r);w(P.data),x(fe=>({...fe,currentPage:P.meta.current_page,totalPages:P.meta.last_page,totalItems:P.meta.total}))}catch{N.error(t("error.load_failed","Failed to load products"))}finally{n(!1)}},[d.currentPage,d.perPage,k,b,c,C,L,t]),$=s.useCallback(async()=>{try{const r=await E.list();_(r)}catch{}},[]);s.useEffect(()=>{H()},[H]),s.useEffect(()=>{$()},[$]),s.useEffect(()=>{x(r=>({...r,currentPage:1}))},[k,b,c]);const le=r=>{C===r?B(P=>P==="asc"?"desc":"asc"):(I(r),B("asc"))},ce=async r=>{K(!0);try{F?(await A.update(F.id,r),N.success(t("products.updated","Product updated successfully"))):(await A.create(r),N.success(t("products.created","Product created successfully"))),l(!1),D(null),H()}finally{K(!1)}},de=async()=>{if(W){V(!0);try{await A.delete(W),N.success(t("products.deleted","Product deleted successfully")),O(null),H()}catch{N.error(t("error.delete_failed","Failed to delete product"))}finally{V(!1)}}},me=r=>{if(!r.barcode){N.error(t("products.no_barcode","Product does not have a barcode"));return}U(r)},ue=r=>new Intl.NumberFormat(v,{minimumFractionDigits:3,maximumFractionDigits:3}).format(r)+" "+t("currency.lyd","LYD"),he=[{key:"sku",header:t("products.sku","SKU"),sortable:!0,width:"120px"},{key:"name",header:t("products.name","Name"),sortable:!0,render:r=>e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",style:{color:"var(--color-gray-900)"},children:r.name}),r.barcode&&e.jsx("div",{className:"text-xs",style:{color:"var(--color-gray-500)"},children:r.barcode})]})},{key:"category",header:t("products.category","Category"),hideOnMobile:!0,render:r=>e.jsx("span",{style:{color:"var(--color-gray-600)"},children:r.category?.name||"-"})},{key:"price",header:t("products.price","Price"),sortable:!0,align:"end",render:r=>e.jsx("span",{dir:"ltr",className:"font-medium",style:{color:"var(--color-gray-900)"},children:ue(r.price)})},{key:"stock_quantity",header:t("products.stock","Stock"),align:"end",hideOnMobile:!0,render:r=>e.jsx("span",{className:"font-medium",style:{color:(r.stock_quantity||0)<=r.min_stock_level?"var(--color-error-600)":"var(--color-gray-900)"},children:r.stock_quantity??"-"})},{key:"is_active",header:t("products.status","Status"),align:"center",width:"100px",render:r=>e.jsx(be,{variant:r.is_active?"success":"default",dot:!0,children:r.is_active?t("common.active","Active"):t("common.inactive","Inactive")})}],pe=r=>e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[i&&e.jsx("button",{onClick:()=>me(r),disabled:!r.barcode,className:"btn btn-ghost p-2",style:{color:r.barcode?"var(--color-primary-600)":"var(--color-gray-400)",minHeight:"48px",minWidth:"48px"},title:r.barcode?t("products.print_barcode","Print Barcode"):t("products.no_barcode","No barcode assigned"),children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})})}),p&&e.jsx("button",{onClick:()=>{D(r),l(!0)},className:"btn btn-ghost p-2",style:{minHeight:"48px",minWidth:"48px"},title:t("common.edit","Edit"),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),g&&e.jsx("button",{onClick:()=>O(r.id),className:"btn btn-ghost p-2",style:{color:"var(--color-error-600)",minHeight:"48px",minWidth:"48px"},title:t("common.delete","Delete"),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),ge=[{value:"",label:t("common.all_categories","All Categories")},...m.map(r=>({value:r.id,label:r.name}))],xe=[{value:"all",label:t("common.all","All")},{value:"active",label:t("common.active","Active")},{value:"inactive",label:t("common.inactive","Inactive")}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl font-semibold",style:{color:"var(--color-gray-900)"},children:t("nav.products","Products")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>J(!0),className:"btn btn-secondary",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),t("categories.manage","Categories")]}),a&&e.jsxs("button",{onClick:()=>{D(null),l(!0)},className:"btn btn-primary",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),t("products.add","Add Product")]})]})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(ye,{value:k,onChange:u,placeholder:t("products.search_placeholder","Search by name, SKU, or barcode...")})}),e.jsx("div",{className:"w-full lg:w-48",children:e.jsx(T,{value:b,onChange:r=>h(r),options:ge,clearable:!0})}),e.jsx("div",{className:"w-full lg:w-36",children:e.jsx(T,{value:c,onChange:r=>j(r||"all"),options:xe})})]})}),e.jsx("div",{className:"card p-0",children:e.jsx(Ce,{columns:he,data:y,keyExtractor:r=>r.id,isLoading:f,emptyIcon:"ðŸ“¦",emptyTitle:t("products.empty","No products found"),emptyDescription:t("products.empty_desc","Add your first product to get started"),emptyAction:a?e.jsx("button",{onClick:()=>{D(null),l(!0)},className:"btn btn-primary",children:t("products.add","Add Product")}):void 0,sortKey:C,sortDirection:L,onSort:le,rowActions:p||g||i?pe:void 0,pagination:{...d,onPageChange:r=>x(P=>({...P,currentPage:r}))}})}),e.jsx(Ne,{isOpen:z,onClose:()=>{l(!1),D(null)},onSubmit:ce,product:F,categories:m,isLoading:ie}),e.jsx(_e,{isOpen:ne,onClose:()=>J(!1),onCategoriesChange:$}),e.jsx(te,{isOpen:W!==null,onClose:()=>O(null),onConfirm:de,title:t("products.delete_title","Delete Product"),message:t("products.delete_confirm","Are you sure you want to delete this product? This action cannot be undone."),confirmText:t("common.delete","Delete"),isLoading:oe}),e.jsx(ae,{isOpen:R!==null,onClose:()=>U(null),product:R})]})}export{$e as ProductsPage,$e as default};
