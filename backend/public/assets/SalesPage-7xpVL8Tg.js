import{a as E,g as $,s as w,t as g,j as e,S as U,L as Y,B as c}from"./index-DkfHMTYM.js";import{r as n}from"./vendor-react-DsCSLZ3L.js";import{M as q}from"./Modal-hvxVst1A.js";import{C as Q}from"./ConfirmDialog-CnKPXxUr.js";import{D as G}from"./DataTable-DveJ996B.js";import{D as J}from"./DateRangePicker-D3Np1JXj.js";import"./vendor-utils-DMdnf9MG.js";import"./vendor-charts-DGg1Za7c.js";import"./vendor-icons-DU-kWQ55.js";function oe(){const{t:s,locale:o}=E(),{hasPermission:t}=$(),r=t("sales.void"),[x,V]=n.useState([]),[D,k]=n.useState(!0),[i,j]=n.useState({currentPage:1,totalPages:1,totalItems:0,perPage:15}),[u,W]=n.useState(""),[d,B]=n.useState({start:null,end:null}),[h,I]=n.useState(""),[m,S]=n.useState(null),[L,_]=n.useState(!1),[v,y]=n.useState(null),[z,C]=n.useState(!1),p=a=>new Intl.NumberFormat(o==="ar"?"ar-LY":"en-LY",{style:"currency",currency:"LYD",minimumFractionDigits:3}).format(a),f=n.useMemo(()=>{const a=x.reduce((F,P)=>F+(P.total_amount??P.grand_total),0),l=x.length,b=l>0?a/l:0;return{totalAmount:a,totalCount:l,avgSale:b}},[x]),N=n.useCallback(async()=>{k(!0);try{const a={page:i.currentPage,per_page:i.perPage,search:u||void 0,status:h||void 0,date_from:d.start?.toISOString().split("T")[0]||void 0,date_to:d.end?.toISOString().split("T")[0]||void 0},l=await w.list(a);V(l.data),j(b=>({...b,currentPage:l.meta.current_page,totalPages:l.meta.last_page,totalItems:l.meta.total}))}catch{g.error(s("error.load_failed","Failed to load sales"))}finally{k(!1)}},[i.currentPage,i.perPage,u,d,h,s]),M=async a=>{_(!0);try{const l=await w.get(a);S(l)}catch{g.error(s("error.load_failed","Failed to load sale details"))}finally{_(!1)}},R=async()=>{if(v){C(!0);try{await w.void(v.id,"Voided by user"),g.success(s("sales.voided","Sale voided successfully")),y(null),N()}catch{g.error(s("error.void_failed","Failed to void sale"))}finally{C(!1)}}};n.useEffect(()=>{N()},[N]),n.useEffect(()=>{j(a=>({...a,currentPage:1}))},[u,d,h]);const T=a=>{switch(a){case"completed":return e.jsx(c,{variant:"success",dot:!0,children:s("sales.completed","Completed")});case"refunded":return e.jsx(c,{variant:"warning",dot:!0,children:s("sales.refunded","Refunded")});case"voided":return e.jsx(c,{variant:"danger",dot:!0,children:s("sales.voided","Voided")});case"pending":return e.jsx(c,{variant:"info",dot:!0,children:s("sales.pending","Pending")});default:return e.jsx(c,{variant:"default",children:a})}},A=[{key:"receipt_number",header:s("sales.receipt","Receipt #"),width:"140px",render:a=>e.jsxs("button",{onClick:()=>M(a.id),className:"flex items-center gap-2 font-mono text-sm hover:text-primary-700 transition-colors group",style:{color:"var(--color-primary-600)"},children:[e.jsx("svg",{className:"w-4 h-4 opacity-50 group-hover:opacity-100",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),a.receipt_number]})},{key:"created_at",header:s("sales.date","Date"),sortable:!0,render:a=>{const l=new Date(a.created_at);return e.jsxs("div",{className:"flex flex-col text-sm",children:[e.jsx("span",{className:"font-medium",style:{color:"var(--color-gray-900)"},children:l.toLocaleDateString(o,{month:"short",day:"numeric",year:"numeric"})}),e.jsx("span",{className:"text-xs",style:{color:"var(--color-gray-500)"},children:l.toLocaleTimeString(o,{hour:"2-digit",minute:"2-digit"})})]})}},{key:"customer",header:s("sales.customer","Customer"),hideOnMobile:!0,render:a=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-100 flex items-center justify-center text-xs font-medium text-gray-600",children:(a.customer?.name||"?").charAt(0).toUpperCase()}),e.jsx("span",{style:{color:"var(--color-gray-700)"},children:a.customer?.name||e.jsx("span",{className:"italic text-gray-400",children:s("sales.walk_in","Walk-in")})})]})},{key:"items_count",header:s("sales.items","Items"),align:"center",hideOnMobile:!0,width:"80px",render:a=>e.jsx("span",{className:"inline-flex items-center justify-center px-2 py-1 rounded-full bg-gray-50 text-xs font-medium text-gray-600",children:a.items_count??"-"})},{key:"total_amount",header:s("sales.total","Total"),align:"end",sortable:!0,render:a=>e.jsx("span",{className:`font-bold ${a.status==="void"||a.status==="voided"?"line-through text-gray-400":"text-gray-900"}`,children:p(a.total_amount??a.grand_total)})},{key:"status",header:s("sales.status","Status"),align:"center",width:"120px",render:a=>T(a.status)},{key:"cashier",header:s("sales.cashier","Cashier"),hideOnMobile:!0,render:a=>e.jsx("span",{className:"text-sm",style:{color:"var(--color-gray-600)"},children:a.user?.name})}],H=a=>a.status!=="completed"?null:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("button",{onClick:()=>M(a.id),className:"btn btn-ghost p-2",title:s("common.view","View"),children:e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),r&&e.jsx("button",{onClick:()=>y(a),className:"btn btn-ghost p-2",style:{color:"var(--color-error-600)"},title:s("sales.void","Void"),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"})})})]}),O=[{value:"",label:s("common.all_statuses","All Statuses")},{value:"completed",label:s("sales.completed","Completed")},{value:"refunded",label:s("sales.refunded","Refunded")},{value:"voided",label:s("sales.voided","Voided")},{value:"pending",label:s("sales.pending","Pending")}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",style:{color:"var(--color-gray-900)"},children:s("nav.sales","Sales History")}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--color-gray-500)"},children:s("sales.subtitle","Manage and view your sales transactions")})]}),e.jsxs("div",{className:"text-sm font-medium px-3 py-1 rounded-full bg-gray-100",style:{color:"var(--color-gray-600)"},children:[i.totalItems," ",s("common.records","records")]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"card p-4 border-l-4",style:{borderLeftColor:"var(--color-primary-500)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--color-gray-500)"},children:s("sales.page_total","Page Total")}),e.jsx("p",{className:"text-2xl font-bold mt-1",style:{color:"var(--color-gray-900)"},children:p(f.totalAmount)})]}),e.jsx("div",{className:"p-3 rounded-full bg-primary-50 text-primary-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})}),e.jsx("div",{className:"card p-4 border-l-4",style:{borderLeftColor:"var(--color-secondary-500)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--color-gray-500)"},children:s("sales.transactions","Transactions")}),e.jsx("p",{className:"text-2xl font-bold mt-1",style:{color:"var(--color-gray-900)"},children:f.totalCount})]}),e.jsx("div",{className:"p-3 rounded-full bg-secondary-50 text-secondary-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})})})]})}),e.jsx("div",{className:"card p-4 border-l-4",style:{borderLeftColor:"var(--color-success-500)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--color-gray-500)"},children:s("sales.avg_value","Avg. Value")}),e.jsx("p",{className:"text-2xl font-bold mt-1",style:{color:"var(--color-gray-900)"},children:p(f.avgSale)})]}),e.jsx("div",{className:"p-3 rounded-full bg-success-50 text-success-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})})})]})})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(U,{value:u,onChange:W,placeholder:s("sales.search_placeholder","Search by receipt # or customer...")})}),e.jsx("div",{className:"w-full lg:w-80",children:e.jsx(J,{value:d,onChange:B})}),e.jsx("select",{value:h,onChange:a=>I(a.target.value),className:"input",style:{width:"auto",minWidth:"150px"},children:O.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]})}),e.jsx("div",{className:"card p-0",children:e.jsx(G,{columns:A,data:x,keyExtractor:a=>a.id,isLoading:D,emptyIcon:"ðŸ§¾",emptyTitle:s("sales.empty","No sales found"),emptyDescription:s("sales.empty_desc","Sales will appear here after transactions"),rowActions:H,pagination:{...i,onPageChange:a=>j(l=>({...l,currentPage:a}))}})}),e.jsx(q,{isOpen:m!==null||L,onClose:()=>S(null),title:m?`${s("sales.receipt","Receipt")} #${m.receipt_number}`:s("common.loading","Loading..."),size:"lg",children:L?e.jsx("div",{className:"py-12",children:e.jsx(Y,{})}):m?e.jsx(K,{sale:m,formatCurrency:p,t:s}):null}),e.jsx(Q,{isOpen:v!==null,onClose:()=>y(null),onConfirm:R,title:s("sales.void_sale","Void Sale"),message:s("sales.void_confirm","Are you sure you want to void this sale? This action cannot be undone."),confirmLabel:s("sales.void","Void"),variant:"danger",isLoading:z})]})}function K({sale:s,formatCurrency:o,t}){return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-500 w-20",children:[t("sales.receipt","Receipt"),":"]}),e.jsx("span",{className:"font-mono font-medium text-gray-900",children:s.receipt_number})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-500 w-20",children:[t("sales.date","Date"),":"]}),e.jsx("span",{className:"text-gray-900",children:new Date(s.created_at).toLocaleString()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-500 w-20",children:[t("sales.cashier","Cashier"),":"]}),e.jsx("span",{className:"text-gray-900",children:s.user?.name})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-500 w-20",children:[t("sales.customer","Customer"),":"]}),e.jsx("span",{className:"font-medium text-gray-900",children:s.customer?.name||t("sales.walk_in","Walk-in")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-500 w-20",children:[t("sales.status","Status"),":"]}),e.jsx(c,{variant:s.status==="completed"?"success":s.status==="void"||s.status==="voided"?"danger":"warning",children:s.status.toUpperCase()})]})]})]})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-3 text-gray-900 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),t("sales.items","Items")]}),e.jsx("div",{className:"border rounded-lg overflow-hidden border-gray-200 shadow-sm",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-start font-medium text-gray-600",children:t("products.name","Product")}),e.jsx("th",{className:"px-4 py-3 text-center font-medium text-gray-600 w-20",children:t("sales.qty","Qty")}),e.jsx("th",{className:"px-4 py-3 text-end font-medium text-gray-600 w-32",children:t("sales.price","Price")}),e.jsx("th",{className:"px-4 py-3 text-end font-medium text-gray-600 w-32",children:t("sales.subtotal","Total")})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 bg-white",children:s.items.map(r=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3 text-gray-900",children:[e.jsx("div",{className:"font-medium",children:r.product?.name||r.product_name}),(r.discount??0)>0&&e.jsxs("div",{className:"text-xs text-warning-600 mt-0.5",children:["Discount: ",r.discount,"%"]})]}),e.jsx("td",{className:"px-4 py-3 text-center text-gray-600",children:r.quantity}),e.jsx("td",{className:"px-4 py-3 text-end text-gray-600",children:o(r.unit_price)}),e.jsx("td",{className:"px-4 py-3 text-end font-medium text-gray-900",children:o(r.subtotal??r.total)})]},r.id))})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"font-semibold mb-3 text-gray-900 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})}),t("sales.payments","Payments")]}),e.jsx("div",{className:"space-y-2",children:s.payments.map(r=>e.jsxs("div",{className:"flex justify-between items-center p-3 rounded-lg border border-gray-200 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 rounded bg-gray-100 text-gray-600",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm text-gray-900",children:r.payment_method?.name||"Unknown"}),r.reference&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Ref: ",r.reference]})]})]}),e.jsx("span",{className:"font-semibold text-gray-900",children:o(r.amount)})]},r.id))})]}),e.jsx("div",{className:"w-full sm:w-72",children:e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200 space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:t("sales.subtotal","Subtotal")}),e.jsx("span",{className:"font-medium text-gray-900",children:o(s.subtotal)})]}),s.discount_amount>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:[t("sales.discount","Discount"),s.discount_percent?` (${s.discount_percent}%)`:""]}),e.jsxs("span",{className:"text-error-600 font-medium",children:["-",o(s.discount_amount)]})]}),e.jsx("div",{className:"border-t border-gray-300 pt-3 mt-1",children:e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsx("span",{className:"font-bold text-gray-900",children:t("sales.total","Total")}),e.jsx("span",{className:"font-bold text-xl text-primary-600",children:o(s.total_amount??s.grand_total)})]})})]})})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t border-gray-100",children:e.jsxs("button",{onClick:()=>window.print(),className:"btn btn-secondary flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),t("common.print","Print Receipt")]})})]})}export{oe as SalesPage,oe as default};
