import{a as z,g as q,v as S,t as j,x as $,j as e,B as b,S as G}from"./index-Nde1j7Yg.js";import{r as c}from"./vendor-react-DsCSLZ3L.js";import{M as B}from"./Modal-CZ93Kggo.js";import{C as J}from"./ConfirmDialog-BEamoI77.js";import{D as K}from"./DataTable-FLyZqxk_.js";import{F}from"./FormField-DuaIuRcX.js";import{F as Q}from"./FormError-D4zmGTMi.js";import{F as U}from"./FormActions-Do4OpoxV.js";import"./vendor-utils-DMdnf9MG.js";import"./vendor-charts-DGg1Za7c.js";import"./vendor-icons-Doz15FS9.js";function I(i){const s=new Map;return i.forEach(a=>{const p=a.group||a.name.split(".")[0];s.has(p)||s.set(p,[]),s.get(p).push(a)}),s}function O(i,s){return{products:s("permissions.module_products","Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª"),categories:s("permissions.module_categories","Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª"),inventory:s("permissions.module_inventory","Ø§Ù„Ù…Ø®Ø²ÙˆÙ†"),sales:s("permissions.module_sales","Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª"),purchases:s("permissions.module_purchases","Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª"),suppliers:s("permissions.module_suppliers","Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†"),customers:s("permissions.module_customers","Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡"),users:s("permissions.module_users","Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†"),roles:s("permissions.module_roles","Ø§Ù„Ø£Ø¯ÙˆØ§Ø±"),reports:s("permissions.module_reports","Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±"),settings:s("permissions.module_settings","Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª"),warehouses:s("permissions.module_warehouses","Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª"),pos:s("permissions.module_pos","Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹"),payment_methods:s("permissions.module_payment_methods","Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹"),audit:s("permissions.module_audit","Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚"),offline:s("permissions.module_offline","Ø§Ù„Ù…ØªØµÙ„/ØºÙŠØ± Ø§Ù„Ù…ØªØµÙ„"),reconciliation:s("permissions.module_reconciliation","Ø§Ù„ØªÙˆÙÙŠÙ‚")}[i]||i}function W(i,s){return{view:s("permissions.action_view","Ø¹Ø±Ø¶"),create:s("permissions.action_create","Ø¥Ø¶Ø§ÙØ©"),update:s("permissions.action_update","ØªØ­Ø¯ÙŠØ«"),edit:s("permissions.action_edit","ØªØ¹Ø¯ÙŠÙ„"),delete:s("permissions.action_delete","Ø­Ø°Ù"),manage:s("permissions.action_manage","Ø¥Ø¯Ø§Ø±Ø©"),export:s("permissions.action_export","ØªØµØ¯ÙŠØ±"),import:s("permissions.action_import","Ø§Ø³ØªÙŠØ±Ø§Ø¯"),assign_roles:s("permissions.action_assign_roles","Ø¥Ø³Ù†Ø§Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±"),refund:s("permissions.action_refund","Ø§Ø³ØªØ±Ø¬Ø§Ø¹"),access:s("permissions.action_access","Ø§Ù„ÙˆØµÙˆÙ„"),void_sale:s("permissions.action_void_sale","Ø¥Ù„ØºØ§Ø¡ Ù…Ø¨ÙŠØ¹Ø©"),apply_discount:s("permissions.action_apply_discount","ØªØ·Ø¨ÙŠÙ‚ Ø®ØµÙ…"),adjust:s("permissions.action_adjust","ØªØ¹Ø¯ÙŠÙ„"),receive:s("permissions.action_receive","Ø§Ø³ØªÙ‚Ø¨Ø§Ù„"),return:s("permissions.action_return","Ø§Ø³ØªØ±Ø¬Ø§Ø¹"),sync:s("permissions.action_sync","Ù…Ø²Ø§Ù…Ù†Ø©"),resolve_conflicts:s("permissions.action_resolve_conflicts","Ø­Ù„ Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª")}[i]||i}function de(){const{t:i,locale:s}=z(),{hasPermission:a}=q(),p=a("roles.create"),x=a("roles.edit"),n=a("roles.delete"),[u,l]=c.useState([]),[m,k]=c.useState([]),[w,y]=c.useState(!0),[h,v]=c.useState({currentPage:1,totalPages:1,totalItems:0,perPage:15}),[f,L]=c.useState(""),[E,_]=c.useState(!1),[P,N]=c.useState(null),[o,d]=c.useState(null),[t,g]=c.useState(null),[M,R]=c.useState(!1),C=c.useCallback(async()=>{y(!0);try{const r=await S.list({page:h.currentPage,per_page:h.perPage,search:f||void 0});l(r.data),v(D=>({...D,currentPage:r.meta.current_page,totalPages:r.meta.last_page,totalItems:r.meta.total}))}catch{j.error(i("error.load_failed","ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±"))}finally{y(!1)}},[h.currentPage,h.perPage,f,i]),A=c.useCallback(async()=>{try{const r=await $.list();k(r)}catch{}},[]),H=async()=>{if(t){R(!0);try{await S.delete(t.id),j.success(i("roles.deleted","ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¯ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­")),g(null),C()}catch{j.error(i("error.delete_failed","ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¯ÙˆØ±"))}finally{R(!1)}}};c.useEffect(()=>{C()},[C]),c.useEffect(()=>{A()},[A]),c.useEffect(()=>{v(r=>({...r,currentPage:1}))},[f]);const T=[{key:"name",header:i("roles.name","Ø§Ù„Ø§Ø³Ù…"),sortable:!0,render:r=>e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",style:{color:"var(--color-gray-900)"},children:r.name}),r.is_system&&e.jsx(b,{variant:"info",size:"sm",className:"ms-2",children:i("roles.system","Ù†Ø¸Ø§Ù…")})]})},{key:"description",header:i("roles.description","Ø§Ù„ÙˆØµÙ"),hideOnMobile:!0,render:r=>e.jsx("span",{style:{color:"var(--color-gray-600)"},children:r.description||"-"})},{key:"permissions",header:i("roles.permissions","Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª"),render:r=>e.jsxs("button",{onClick:()=>d(r),className:"flex items-center gap-2 hover:underline",style:{color:"var(--color-primary-600)"},children:[e.jsx("span",{className:"font-semibold",children:r.permissions?.length||0}),e.jsx("span",{className:"text-sm",children:i("roles.permissions_label","ØµÙ„Ø§Ø­ÙŠØ§Øª")})]})},{key:"users_count",header:i("roles.users","Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†"),align:"center",hideOnMobile:!0,width:"100px",render:r=>e.jsx(b,{variant:"default",children:r.users_count||0})},{key:"created_at",header:i("roles.created","ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡"),hideOnMobile:!0,render:r=>e.jsx("span",{style:{color:"var(--color-gray-600)"},children:r.created_at?new Date(r.created_at).toLocaleDateString(s):"-"})}],V=r=>e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("button",{onClick:()=>d(r),className:"btn btn-ghost p-2",title:i("common.view","Ø¹Ø±Ø¶"),children:e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),x&&!r.is_system&&e.jsx("button",{onClick:()=>{N(r),_(!0)},className:"btn btn-ghost p-2",title:i("common.edit","ØªØ¹Ø¯ÙŠÙ„"),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),n&&!r.is_system&&e.jsx("button",{onClick:()=>g(r),className:"btn btn-ghost p-2",style:{color:"var(--color-error-600)"},title:i("common.delete","Ø­Ø°Ù"),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl font-semibold",style:{color:"var(--color-gray-900)"},children:i("nav.roles","Ø§Ù„Ø£Ø¯ÙˆØ§Ø±")}),p&&e.jsxs("button",{onClick:()=>{N(null),_(!0)},className:"btn btn-primary",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),i("roles.add","Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ±")]})]}),e.jsx("div",{className:"card",children:e.jsx(G,{value:f,onChange:L,placeholder:i("roles.search_placeholder","Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£Ø¯ÙˆØ§Ø±...")})}),e.jsx("div",{className:"card p-0",children:e.jsx(K,{columns:T,data:u,keyExtractor:r=>r.id,isLoading:w,emptyIcon:"ðŸ›¡ï¸",emptyTitle:i("roles.empty","Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ø¯ÙˆØ§Ø±"),emptyDescription:i("roles.empty_desc","Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø¯ÙˆØ± Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¨Ø¯Ø¡"),rowActions:x||n?V:void 0,pagination:{...h,onPageChange:r=>v(D=>({...D,currentPage:r}))}})}),e.jsx(X,{isOpen:E,onClose:()=>_(!1),role:P,permissions:m,onSuccess:()=>{_(!1),C()}}),e.jsx(B,{isOpen:o!==null,onClose:()=>d(null),title:o?.name||"",size:"lg",children:o&&e.jsx(Y,{permissions:o.permissions||[],allPermissions:m,t:i})}),e.jsx(J,{isOpen:t!==null,onClose:()=>g(null),onConfirm:H,title:i("roles.delete_role","Ø­Ø°Ù Ø§Ù„Ø¯ÙˆØ±"),message:i("roles.delete_confirm","Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙˆØ±ØŸ Ø³ÙŠÙÙ‚Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ø°ÙŠÙ† Ù„Ø¯ÙŠÙ‡Ù… Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙˆØ± ØµÙ„Ø§Ø­ÙŠØ§ØªÙ‡Ù…."),confirmLabel:i("common.delete","Ø­Ø°Ù"),variant:"danger",isLoading:M})]})}function X({isOpen:i,onClose:s,role:a,permissions:p,onSuccess:x}){const{t:n}=z(),u=a!==null,[l,m]=c.useState({name:"",description:"",permission_ids:[]}),[k,w]=c.useState({}),[y,h]=c.useState(null),[v,f]=c.useState(!1),L=I(p);c.useEffect(()=>{i&&(m(a?{name:a.name,description:a.description||"",permission_ids:a.permissions?.map(o=>o.id)||[]}:{name:"",description:"",permission_ids:[]}),w({}),h(null))},[i,a]);const E=()=>{const o={};return l.name.trim()||(o.name=n("validation.required","Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ Ù…Ø·Ù„ÙˆØ¨")),w(o),Object.keys(o).length===0},_=async o=>{if(o.preventDefault(),!!E()){f(!0),h(null);try{u&&a?(await S.update(a.id,{name:l.name,description:l.description,permission_ids:l.permission_ids}),j.success(n("roles.updated","ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­"))):(await S.create({name:l.name,description:l.description,permission_ids:l.permission_ids}),j.success(n("roles.created","ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¯ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­"))),x()}catch(d){h(d instanceof Error?d.message:n("error.save_failed","ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­ÙØ¸"))}finally{f(!1)}}},P=o=>{m(d=>({...d,permission_ids:d.permission_ids.includes(o)?d.permission_ids.filter(t=>t!==o):[...d.permission_ids,o]}))},N=o=>{const d=o.every(t=>l.permission_ids.includes(t.id));m(d?t=>({...t,permission_ids:t.permission_ids.filter(g=>!o.some(M=>M.id===g))}):t=>({...t,permission_ids:[...t.permission_ids,...o.map(g=>g.id).filter(g=>!t.permission_ids.includes(g))]}))};return e.jsx(B,{isOpen:i,onClose:s,title:u?n("roles.edit_role","ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±"):n("roles.add_role","Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ±"),size:"lg",children:e.jsxs("form",{onSubmit:_,children:[y&&e.jsx(Q,{message:y}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(F,{label:n("roles.name","Ø§Ù„Ø§Ø³Ù…"),required:!0,error:k.name,children:e.jsx("input",{type:"text",value:l.name,onChange:o=>m({...l,name:o.target.value}),className:`input ${k.name?"input-error":""}`,placeholder:n("roles.name_placeholder","Ù…Ø«Ù„Ø§Ù‹: Ø£Ù…ÙŠÙ† Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª")})}),e.jsx(F,{label:n("roles.description","Ø§Ù„ÙˆØµÙ"),children:e.jsx("textarea",{value:l.description||"",onChange:o=>m({...l,description:o.target.value}),className:"input",rows:2,placeholder:n("roles.description_placeholder","ÙˆØµÙ Ù…ÙˆØ¬Ø² Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙˆØ±")})}),e.jsx(F,{label:n("roles.permissions","Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª"),children:e.jsx("div",{className:"max-h-80 overflow-y-auto rounded-lg border p-4 space-y-4",style:{borderColor:"var(--color-gray-200)"},children:Array.from(L.entries()).map(([o,d])=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"checkbox",checked:d.every(t=>l.permission_ids.includes(t.id)),onChange:()=>N(d),className:"w-4 h-4 rounded",style:{accentColor:"var(--color-primary-600)"}}),e.jsx("span",{className:"font-semibold",style:{color:"var(--color-gray-900)"},children:O(o,n)}),e.jsxs(b,{variant:"default",size:"sm",children:[d.filter(t=>l.permission_ids.includes(t.id)).length,"/",d.length]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 ms-6",children:d.map(t=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer text-sm",children:[e.jsx("input",{type:"checkbox",checked:l.permission_ids.includes(t.id),onChange:()=>P(t.id),className:"w-4 h-4 rounded",style:{accentColor:"var(--color-primary-600)"}}),e.jsx("span",{style:{color:"var(--color-gray-700)"},children:W(t.name.split(".")[1],n)})]},t.id))})]},o))})})]}),e.jsx(U,{onCancel:s,isSubmitting:v,submitLabel:u?n("common.save","Ø­ÙØ¸"):n("roles.create","Ø¥Ù†Ø´Ø§Ø¡ Ø¯ÙˆØ±")})]})})}function Y({permissions:i,allPermissions:s,t:a}){const p=new Set(i.map(n=>n.id)),x=I(s);return e.jsxs("div",{className:"space-y-4",children:[Array.from(x.entries()).map(([n,u])=>{const l=u.filter(m=>p.has(m.id)).length;return l===0?null:e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--color-gray-50)"},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"font-semibold",style:{color:"var(--color-gray-900)"},children:O(n,a)}),e.jsxs(b,{variant:"primary",size:"sm",children:[l,"/",u.length]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:u.map(m=>e.jsxs(b,{variant:p.has(m.id)?"success":"default",size:"sm",children:[p.has(m.id)?"âœ“ ":"",W(m.name.split(".")[1],a)]},m.id))})]},n)}),i.length===0&&e.jsx("div",{className:"text-center py-8",style:{color:"var(--color-gray-500)"},children:a("roles.no_permissions","Ù„Ù… ØªØªÙ… Ø¥Ø³Ù†Ø§Ø¯ Ø£ÙŠ ØµÙ„Ø§Ø­ÙŠØ§Øª")})]})}export{de as RolesPage,de as default};
